import{Extension as e,PropertyType as t,GLB_BUFFER as s,ExtensionProperty as r,COPY_IDENTITY as o,ColorUtils as n,TextureInfo as i,GraphChild as a}from"@gltf-transform/core";const c="EXT_texture_webp";class u extends e{constructor(){super(...arguments),this.extensionName=c,this.provideTypes=[t.TEXTURE]}provide(e){return e.jsonDoc.json.textures.forEach(e=>{e.extensions&&e.extensions[c]&&(e.source=e.extensions[c].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(s=>{if("image/webp"===s.getMimeType()){const r=e.imageIndexMap.get(s);t.json.textures.forEach(e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[c]={source:e.source},delete e.source)})}}),this}}let l,h,x;function T(e,t){let s;try{if(s=new l.DecoderBuffer,s.Init(new Int8Array(t),t.byteLength),e.GetEncodedGeometryType(s)!==l.TRIANGULAR_MESH)throw new Error("Unknown geometry type.");const r=new l.Mesh;if(!e.DecodeBufferToMesh(s,r).ok()||0===r.ptr)throw new Error("Decoding failure.");return r}finally{l.destroy(s)}}function g(e,t){const s=3*t.num_faces(),r=s*Uint32Array.BYTES_PER_ELEMENT,o=l._malloc(r);e.GetTrianglesUInt32Array(t,r,o);const n=new Uint32Array(l.HEAP32.buffer,o,s).slice();return l._free(o),n}function p(e,t,s,r){const o=x[r.componentType],n=h[r.componentType],i=s.num_components(),a=t.num_points()*i,c=a*n.BYTES_PER_ELEMENT,u=l._malloc(c);e.GetAttributeDataArrayForAllPoints(t,s,o,c,u);const T=new n(l.HEAPF32.buffer,u,a).slice();return l._free(u),T}u.EXTENSION_NAME=c;const f="KHR_draco_mesh_compression";class d extends e{constructor(){super(...arguments),this.extensionName=f,this.provideTypes=[t.PRIMITIVE],this.dependencies=["draco3d.decoder"]}install(e,t){return"draco3d.decoder"===e&&(this._decoderModule=t,l=this._decoderModule,h={5126:Float32Array,5125:Uint32Array,5123:Uint16Array,5121:Uint8Array,5122:Int16Array,5120:Int8Array},x={5126:l.DT_FLOAT32,5125:l.DT_UINT32,5123:l.DT_UINT16,5121:l.DT_UINT8,5122:l.DT_INT16,5120:l.DT_INT8}),this}provide(e){if(!this._decoderModule)throw new Error('Please install extension dependency, "draco3d.decoder".');const t=this.doc.getLogger(),r=e.jsonDoc,o=new this._decoderModule.Decoder,n=new Map;for(const i of r.json.meshes){for(const a of i.primitives){if(!a.extensions||!a.extensions[f])continue;const i=a.extensions[f];let c=n.get(i.bufferView);if(!c){const e=r.json.bufferViews[i.bufferView],a=r.json.buffers[e.buffer],u=new Uint8Array(a.uri?r.resources[a.uri]:r.resources[s],e.byteOffset||0,e.byteLength);c=T(o,u),n.set(i.bufferView,c),t.debug(`Decompressed ${u.byteLength} bytes.`)}for(const t in a.attributes){const s=e.jsonDoc.json.accessors[a.attributes[t]],r=o.GetAttributeByUniqueId(c,i.attributes[t]),n=p(o,c,r,s);e.accessors[a.attributes[t]].setArray(n)}const u=g(o,c);e.accessors[a.indices].setArray(u)}this._decoderModule.destroy(o);for(const e of Array.from(n.values()))this._decoderModule.destroy(e)}return this}read(e){return this.dispose(),this}write(e){return this.doc.getLogger().warn(`Writing ${this.extensionName} not yet implemented.`),this}}var _;d.EXTENSION_NAME=f,function(e){e.POINT="point",e.SPOT="spot",e.DIRECTIONAL="directional"}(_||(_={}));class m extends r{constructor(){super(...arguments),this.propertyType="Light",this.parentTypes=[t.NODE],this.extensionName="KHR_lights_punctual",this._color=[1,1,1],this._intensity=1,this._range=void 0,this._innerConeAngle=0,this._outerConeAngle=Math.PI/4}copy(e,t=o){return super.copy(e,t),this._color=[...e._color],this._intensity=e._intensity,this._type=e._type,this._range=e._range,this._innerConeAngle=e._innerConeAngle,this._outerConeAngle=e._outerConeAngle,this}getColor(){return this._color}setColor(e){return this._color=e,this}getColorHex(){return n.factorToHex(this._color)}setColorHex(e){return n.hexToFactor(e,this._color),this}getIntensity(){return this._intensity}setIntensity(e){return this._intensity=e,this}getType(){return this._type}setType(e){return this._type=e,this}getRange(){return this._range}setRange(e){return this._range=e,this}getInnerConeAngle(){return this._innerConeAngle}setInnerConeAngle(e){return this._innerConeAngle=e,this}getOuterConeAngle(){return this._outerConeAngle}setOuterConeAngle(e){return this._outerConeAngle=e,this}}m.EXTENSION_NAME="KHR_lights_punctual";const C="KHR_lights_punctual";class I extends e{constructor(){super(...arguments),this.extensionName=C}createLight(){return new m(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[C])return this;const s=(t.json.extensions[C].lights||[]).map(e=>{const t=this.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&t.setColor(e.color),void 0!==e.intensity&&t.setIntensity(e.intensity),void 0!==e.range&&t.setRange(e.range),void 0!==e.innerConeAngle&&t.setInnerConeAngle(e.innerConeAngle),void 0!==e.outerConeAngle&&t.setOuterConeAngle(e.outerConeAngle),t});return t.json.nodes.forEach((t,r)=>{t.extensions&&t.extensions[C]&&e.nodes[r].setExtension(C,s[t.extensions[C].light])}),this}write(e){const t=e.jsonDoc;if(0===this.properties.size)return this;const s=[],r=new Map;for(const e of this.properties){const t=e,o={type:t.getType(),color:t.getColor(),intensity:t.getIntensity(),range:t.getRange()};t.getName()&&(o.name=t.getName()),t.getType()===_.SPOT&&(o.innerConeAngle=t.getInnerConeAngle(),o.outerConeAngle=t.getOuterConeAngle()),s.push(o),r.set(t,s.length-1)}return this.doc.getRoot().listNodes().forEach(s=>{const o=s.getExtension(C);if(o){const n=e.nodeIndexMap.get(s),i=t.json.nodes[n];i.extensions=i.extensions||{},i.extensions[C]={light:r.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[C]={lights:s},this}}function R(e,t,s,r){var o,n=arguments.length,i=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(i=(n<3?o(i):n>3?o(t,s,i):o(t,s))||i);return n>3&&i&&Object.defineProperty(t,s,i),i}I.EXTENSION_NAME=C;class N extends r{constructor(){super(...arguments),this.propertyType="Clearcoat",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_clearcoat",this._clearcoatFactor=0,this._clearcoatRoughnessFactor=0,this._clearcoatNormalScale=1,this.clearcoatTexture=null,this.clearcoatTextureInfo=this.graph.link("clearcoatTextureInfo",this,new i(this.graph)),this.clearcoatRoughnessTexture=null,this.clearcoatRoughnessTextureInfo=this.graph.link("clearcoatRoughnessTextureInfo",this,new i(this.graph)),this.clearcoatNormalTexture=null,this.clearcoatNormalTextureInfo=this.graph.link("clearcoatNormalTextureInfo",this,new i(this.graph))}copy(e,t=o){return super.copy(e,t),this._clearcoatFactor=e._clearcoatFactor,this._clearcoatRoughnessFactor=e._clearcoatRoughnessFactor,this._clearcoatNormalScale=e._clearcoatNormalScale,e.clearcoatTexture&&(this.setClearcoatTexture(t(e.clearcoatTexture.getChild())),this.getClearcoatTextureInfo().copy(t(e.clearcoatTextureInfo.getChild()),t)),e.clearcoatRoughnessTexture&&(this.setClearcoatRoughnessTexture(t(e.clearcoatRoughnessTexture.getChild())),this.getClearcoatRoughnessTextureInfo().copy(t(e.clearcoatRoughnessTextureInfo.getChild()),t)),e.clearcoatNormalTexture&&(this.setClearcoatNormalTexture(t(e.clearcoatNormalTexture.getChild())),this.getClearcoatNormalTextureInfo().copy(t(e.clearcoatNormalTextureInfo.getChild()),t)),this}dispose(){this.clearcoatTextureInfo.getChild().dispose(),this.clearcoatRoughnessTextureInfo.getChild().dispose(),this.clearcoatNormalTextureInfo.getChild().dispose(),super.dispose()}getClearcoatFactor(){return this._clearcoatFactor}setClearcoatFactor(e){return this._clearcoatFactor=e,this}getClearcoatTexture(){return this.clearcoatTexture?this.clearcoatTexture.getChild():null}getClearcoatTextureInfo(){return this.clearcoatTexture?this.clearcoatTextureInfo.getChild():null}setClearcoatTexture(e){return this.clearcoatTexture=this.graph.link("clearcoatTexture",this,e),this}getClearcoatRoughnessFactor(){return this._clearcoatRoughnessFactor}setClearcoatRoughnessFactor(e){return this._clearcoatRoughnessFactor=e,this}getClearcoatRoughnessTexture(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTexture.getChild():null}getClearcoatRoughnessTextureInfo(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTextureInfo.getChild():null}setClearcoatRoughnessTexture(e){return this.clearcoatRoughnessTexture=this.graph.link("clearcoatRoughnessTexture",this,e),this}getClearcoatNormalScale(){return this._clearcoatNormalScale}setClearcoatNormalScale(e){return this._clearcoatNormalScale=e,this}getClearcoatNormalTexture(){return this.clearcoatNormalTexture?this.clearcoatNormalTexture.getChild():null}getClearcoatNormalTextureInfo(){return this.clearcoatNormalTexture?this.clearcoatNormalTextureInfo.getChild():null}setClearcoatNormalTexture(e){return this.clearcoatNormalTexture=this.graph.link("clearcoatNormalTexture",this,e),this}}N.EXTENSION_NAME="KHR_materials_clearcoat",R([a],N.prototype,"clearcoatTexture",void 0),R([a],N.prototype,"clearcoatTextureInfo",void 0),R([a],N.prototype,"clearcoatRoughnessTexture",void 0),R([a],N.prototype,"clearcoatRoughnessTextureInfo",void 0),R([a],N.prototype,"clearcoatNormalTexture",void 0),R([a],N.prototype,"clearcoatNormalTextureInfo",void 0);const E="KHR_materials_clearcoat";class y extends e{constructor(){super(...arguments),this.extensionName=E}createClearcoat(){return new N(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[E]){const o=this.createClearcoat();if(e.materials[r].setExtension(E,o),void 0!==t.extensions[E].clearcoatFactor&&o.setClearcoatFactor(t.extensions[E].clearcoatFactor),void 0!==t.extensions[E].clearcoatRoughnessFactor&&o.setClearcoatRoughnessFactor(t.extensions[E].clearcoatRoughnessFactor),void 0!==t.extensions[E].clearcoatTexture){const r=t.extensions[E].clearcoatTexture;o.setClearcoatTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getClearcoatTextureInfo(),r)}if(void 0!==t.extensions[E].clearcoatRoughnessTexture){const r=t.extensions[E].clearcoatRoughnessTexture;o.setClearcoatRoughnessTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getClearcoatRoughnessTextureInfo(),r)}if(void 0!==t.extensions[E].clearcoatNormalTexture){const r=t.extensions[E].clearcoatNormalTexture;o.setClearcoatNormalTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getClearcoatNormalTextureInfo(),r),void 0!==r.scale&&o.setClearcoatNormalScale(r.scale)}}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(E);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];if(n.extensions=n.extensions||{},n.extensions[E]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()},r.getClearcoatTexture()){const t=r.getClearcoatTexture(),s=r.getClearcoatTextureInfo();n.extensions[E].clearcoatTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatRoughnessTexture()){const t=r.getClearcoatRoughnessTexture(),s=r.getClearcoatRoughnessTextureInfo();n.extensions[E].clearcoatRoughnessTexture=e.createTextureInfoDef(t,s)}if(r.getClearcoatNormalTexture()){const t=r.getClearcoatNormalTexture(),s=r.getClearcoatNormalTextureInfo();n.extensions[E].clearcoatNormalTexture=e.createTextureInfoDef(t,s),1!==r.getClearcoatNormalScale()&&(n.extensions[E].clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}}),this}}y.EXTENSION_NAME=E;class F extends r{constructor(){super(...arguments),this.propertyType="IOR",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_ior",this._ior=0}copy(e,t=o){return super.copy(e,t),this._ior=e._ior,this}getIOR(){return this._ior}setIOR(e){return this._ior=e,this}}F.EXTENSION_NAME="KHR_materials_ior";const S="KHR_materials_ior";class A extends e{constructor(){super(...arguments),this.extensionName=S}createIOR(){return new F(this.doc.getGraph(),this)}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,s)=>{if(t.extensions&&t.extensions[S]){const r=this.createIOR();e.materials[s].setExtension(S,r),void 0!==t.extensions[S].ior&&r.setIOR(t.extensions[S].ior)}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(S);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];n.extensions=n.extensions||{},n.extensions[S]={ior:r.getIOR()}}}),this}}A.EXTENSION_NAME=S;class M extends r{constructor(){super(...arguments),this.propertyType="PBRSpecularGlossiness",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_pbrSpecularGlossiness",this._diffuseFactor=[1,1,1,1],this._specularFactor=[1,1,1],this._glossinessFactor=1,this.diffuseTexture=null,this.diffuseTextureInfo=this.graph.link("diffuseTextureInfo",this,new i(this.graph)),this.specularGlossinessTexture=null,this.specularGlossinessTextureInfo=this.graph.link("specularGlossinessTextureInfo",this,new i(this.graph))}copy(e,t=o){return super.copy(e,t),this._diffuseFactor=e._diffuseFactor,this._specularFactor=e._specularFactor,this._glossinessFactor=e._glossinessFactor,e.diffuseTexture&&(this.setDiffuseTexture(t(e.diffuseTexture.getChild())),this.getDiffuseTextureInfo().copy(t(e.diffuseTextureInfo.getChild()),t)),e.specularGlossinessTexture&&(this.setSpecularGlossinessTexture(t(e.specularGlossinessTexture.getChild())),this.getSpecularGlossinessTextureInfo().copy(t(e.specularGlossinessTextureInfo.getChild()),t)),this}dispose(){this.diffuseTextureInfo.getChild().dispose(),this.specularGlossinessTextureInfo.getChild().dispose(),super.dispose()}getDiffuseFactor(){return this._diffuseFactor}setDiffuseFactor(e){return this._diffuseFactor=e,this}getDiffuseHex(){return n.factorToHex(this._diffuseFactor)}setDiffuseHex(e){return n.hexToFactor(e,this._diffuseFactor),this}getDiffuseTexture(){return this.diffuseTexture?this.diffuseTexture.getChild():null}getDiffuseTextureInfo(){return this.diffuseTexture?this.diffuseTextureInfo.getChild():null}setDiffuseTexture(e){return this.diffuseTexture=this.graph.link("diffuseTexture",this,e),this}getSpecularFactor(){return this._specularFactor}setSpecularFactor(e){return this._specularFactor=e,this}getGlossinessFactor(){return this._glossinessFactor}setGlossinessFactor(e){return this._glossinessFactor=e,this}getSpecularGlossinessTexture(){return this.specularGlossinessTexture?this.specularGlossinessTexture.getChild():null}getSpecularGlossinessTextureInfo(){return this.specularGlossinessTexture?this.specularGlossinessTextureInfo.getChild():null}setSpecularGlossinessTexture(e){return this.specularGlossinessTexture=this.graph.link("specularGlossinessTexture",this,e),this}}M.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness",R([a],M.prototype,"diffuseTexture",void 0),R([a],M.prototype,"diffuseTextureInfo",void 0),R([a],M.prototype,"specularGlossinessTexture",void 0),R([a],M.prototype,"specularGlossinessTextureInfo",void 0);const D="KHR_materials_pbrSpecularGlossiness";class v extends e{constructor(){super(...arguments),this.extensionName=D}createPBRSpecularGlossiness(){return new M(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[D]){const o=this.createPBRSpecularGlossiness();if(e.materials[r].setExtension(D,o),void 0!==t.extensions[D].diffuseFactor&&o.setDiffuseFactor(t.extensions[D].diffuseFactor),void 0!==t.extensions[D].specularFactor&&o.setSpecularFactor(t.extensions[D].specularFactor),void 0!==t.extensions[D].glossinessFactor&&o.setGlossinessFactor(t.extensions[D].glossinessFactor),void 0!==t.extensions[D].diffuseTexture){const r=t.extensions[D].diffuseTexture;o.setDiffuseTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getDiffuseTextureInfo(),r)}if(void 0!==t.extensions[D].specularGlossinessTexture){const r=t.extensions[D].specularGlossinessTexture;o.setSpecularGlossinessTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getSpecularGlossinessTextureInfo(),r)}}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(D);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];if(n.extensions=n.extensions||{},n.extensions[D]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()},r.getDiffuseTexture()){const t=r.getDiffuseTexture(),s=r.getDiffuseTextureInfo();n.extensions[D].diffuseTexture=e.createTextureInfoDef(t,s)}if(r.getSpecularGlossinessTexture()){const t=r.getSpecularGlossinessTexture(),s=r.getSpecularGlossinessTextureInfo();n.extensions[D].specularGlossinessTexture=e.createTextureInfoDef(t,s)}}}),this}}v.EXTENSION_NAME=D;class j extends r{constructor(){super(...arguments),this.propertyType="Sheen",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_sheen",this._sheenColorFactor=[0,0,0],this._sheenRoughnessFactor=0,this.sheenColorTexture=null,this.sheenColorTextureInfo=this.graph.link("sheenColorTextureInfo",this,new i(this.graph)),this.sheenRoughnessTexture=null,this.sheenRoughnessTextureInfo=this.graph.link("sheenRoughnessTextureInfo",this,new i(this.graph))}copy(e,t=o){return super.copy(e,t),this._sheenColorFactor=e._sheenColorFactor,this._sheenRoughnessFactor=e._sheenRoughnessFactor,e.sheenColorTexture&&(this.setSheenColorTexture(t(e.sheenColorTexture.getChild())),this.getSheenColorTextureInfo().copy(t(e.sheenColorTextureInfo.getChild()),t)),e.sheenRoughnessTexture&&(this.setSheenRoughnessTexture(t(e.sheenRoughnessTexture.getChild())),this.getSheenRoughnessTextureInfo().copy(t(e.sheenRoughnessTextureInfo.getChild()),t)),this}dispose(){this.sheenColorTextureInfo.getChild().dispose(),this.sheenRoughnessTextureInfo.getChild().dispose(),super.dispose()}getSheenColorFactor(){return this._sheenColorFactor}getSheenColorHex(){return n.factorToHex(this._sheenColorFactor)}setSheenColorFactor(e){return this._sheenColorFactor=e,this}setSheenColorHex(e){return n.hexToFactor(e,this._sheenColorFactor),this}getSheenColorTexture(){return this.sheenColorTexture?this.sheenColorTexture.getChild():null}getSheenColorTextureInfo(){return this.sheenColorTexture?this.sheenColorTextureInfo.getChild():null}setSheenColorTexture(e){return this.sheenColorTexture=this.graph.link("sheenColorTexture",this,e),this}getSheenRoughnessFactor(){return this._sheenRoughnessFactor}setSheenRoughnessFactor(e){return this._sheenRoughnessFactor=e,this}getSheenRoughnessTexture(){return this.sheenRoughnessTexture?this.sheenRoughnessTexture.getChild():null}getSheenRoughnessTextureInfo(){return this.sheenRoughnessTexture?this.sheenRoughnessTextureInfo.getChild():null}setSheenRoughnessTexture(e){return this.sheenRoughnessTexture=this.graph.link("sheenRoughnessTexture",this,e),this}}j.EXTENSION_NAME="KHR_materials_sheen",R([a],j.prototype,"sheenColorTexture",void 0),R([a],j.prototype,"sheenColorTextureInfo",void 0),R([a],j.prototype,"sheenRoughnessTexture",void 0),R([a],j.prototype,"sheenRoughnessTextureInfo",void 0);const w="KHR_materials_sheen";class G extends e{constructor(){super(...arguments),this.extensionName=w}createSheen(){return new j(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[w]){const o=this.createSheen();if(e.materials[r].setExtension(w,o),void 0!==t.extensions[w].sheenColorFactor&&o.setSheenColorFactor(t.extensions[w].sheenColorFactor),void 0!==t.extensions[w].sheenRoughnessFactor&&o.setSheenRoughnessFactor(t.extensions[w].sheenRoughnessFactor),void 0!==t.extensions[w].sheenColorTexture){const r=t.extensions[w].sheenColorTexture;o.setSheenColorTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getSheenColorTextureInfo(),r)}if(void 0!==t.extensions[w].sheenRoughnessTexture){const r=t.extensions[w].sheenRoughnessTexture;o.setSheenRoughnessTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getSheenRoughnessTextureInfo(),r)}}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(w);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];if(n.extensions=n.extensions||{},n.extensions[w]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()},r.getSheenColorTexture()){const t=r.getSheenColorTexture(),s=r.getSheenColorTextureInfo();n.extensions[w].sheenColorTexture=e.createTextureInfoDef(t,s)}if(r.getSheenRoughnessTexture()){const t=r.getSheenRoughnessTexture(),s=r.getSheenRoughnessTextureInfo();n.extensions[w].sheenRoughnessTexture=e.createTextureInfoDef(t,s)}}}),this}}G.EXTENSION_NAME=w;class O extends r{constructor(){super(...arguments),this.propertyType="Specular",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_specular",this._specularFactor=1,this._specularColorFactor=[1,1,1],this.specularTexture=null,this.specularTextureInfo=this.graph.link("specularTextureInfo",this,new i(this.graph))}copy(e,t=o){return super.copy(e,t),this._specularFactor=e._specularFactor,e.specularTexture&&(this.setSpecularTexture(t(e.specularTexture.getChild())),this.getSpecularTextureInfo().copy(t(e.specularTextureInfo.getChild()),t)),this}dispose(){this.specularTextureInfo.getChild().dispose(),super.dispose()}getSpecularFactor(){return this._specularFactor}setSpecularFactor(e){return this._specularFactor=e,this}getSpecularColorFactor(){return this._specularColorFactor}setSpecularColorFactor(e){return this._specularColorFactor=e,this}getSpecularColorHex(){return n.factorToHex(this._specularColorFactor)}setSpecularColorHex(e){return n.hexToFactor(e,this._specularColorFactor),this}getSpecularTexture(){return this.specularTexture?this.specularTexture.getChild():null}getSpecularTextureInfo(){return this.specularTexture?this.specularTextureInfo.getChild():null}setSpecularTexture(e){return this.specularTexture=this.graph.link("specularTexture",this,e),this}}O.EXTENSION_NAME="KHR_materials_specular",R([a],O.prototype,"specularTexture",void 0),R([a],O.prototype,"specularTextureInfo",void 0);const H="KHR_materials_specular";class K extends e{constructor(){super(...arguments),this.extensionName=H}createSpecular(){return new O(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[H]){const o=this.createSpecular();if(e.materials[r].setExtension(H,o),void 0!==t.extensions[H].specularFactor&&o.setSpecularFactor(t.extensions[H].specularFactor),void 0!==t.extensions[H].specularColorFactor&&o.setSpecularColorFactor(t.extensions[H].specularColorFactor),void 0!==t.extensions[H].specularTexture){const r=t.extensions[H].specularTexture;o.setSpecularTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getSpecularTextureInfo(),r)}}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(H);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];if(n.extensions=n.extensions||{},n.extensions[H]={specularFactor:r.getSpecularFactor(),specularColorFactor:r.getSpecularColorFactor()},r.getSpecularTexture()){const t=r.getSpecularTexture(),s=r.getSpecularTextureInfo();n.extensions[H].specularTexture=e.createTextureInfoDef(t,s)}}}),this}}K.EXTENSION_NAME=H;class b extends r{constructor(){super(...arguments),this.propertyType="Transmission",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_transmission",this._transmissionFactor=0,this.transmissionTexture=null,this.transmissionTextureInfo=this.graph.link("transmissionTextureInfo",this,new i(this.graph))}copy(e,t=o){return super.copy(e,t),this._transmissionFactor=e._transmissionFactor,e.transmissionTexture&&(this.setTransmissionTexture(t(e.transmissionTexture.getChild())),this.getTransmissionTextureInfo().copy(t(e.transmissionTextureInfo.getChild()),t)),this}dispose(){this.transmissionTextureInfo.getChild().dispose(),super.dispose()}getTransmissionFactor(){return this._transmissionFactor}setTransmissionFactor(e){return this._transmissionFactor=e,this}getTransmissionTexture(){return this.transmissionTexture?this.transmissionTexture.getChild():null}getTransmissionTextureInfo(){return this.transmissionTexture?this.transmissionTextureInfo.getChild():null}setTransmissionTexture(e){return this.transmissionTexture=this.graph.link("transmissionTexture",this,e),this}}b.EXTENSION_NAME="KHR_materials_transmission",R([a],b.prototype,"transmissionTexture",void 0),R([a],b.prototype,"transmissionTextureInfo",void 0);const X="KHR_materials_transmission";class k extends e{constructor(){super(...arguments),this.extensionName=X}createTransmission(){return new b(this.doc.getGraph(),this)}read(e){const t=e.jsonDoc,s=t.json.textures||[];return(t.json.materials||[]).forEach((t,r)=>{if(t.extensions&&t.extensions[X]){const o=this.createTransmission();if(e.materials[r].setExtension(X,o),void 0!==t.extensions[X].transmissionFactor&&o.setTransmissionFactor(t.extensions[X].transmissionFactor),void 0!==t.extensions[X].transmissionTexture){const r=t.extensions[X].transmissionTexture;o.setTransmissionTexture(e.textures[s[r.index].source]),e.setTextureInfo(o.getTransmissionTextureInfo(),r)}}}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{const r=s.getExtension(X);if(r){const o=e.materialIndexMap.get(s),n=t.json.materials[o];if(n.extensions=n.extensions||{},n.extensions[X]={transmissionFactor:r.getTransmissionFactor()},r.getTransmissionTexture()){const t=r.getTransmissionTexture(),s=r.getTransmissionTextureInfo();n.extensions[X].transmissionTexture=e.createTextureInfoDef(t,s)}}}),this}}k.EXTENSION_NAME=X;class L extends r{constructor(){super(...arguments),this.propertyType="Unlit",this.parentTypes=[t.MATERIAL],this.extensionName="KHR_materials_unlit"}}L.EXTENSION_NAME="KHR_materials_unlit";const U="KHR_materials_unlit";class P extends e{constructor(){super(...arguments),this.extensionName=U}createUnlit(){return new L(this.doc.getGraph(),this)}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,s)=>{t.extensions&&t.extensions[U]&&e.materials[s].setExtension(U,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(s=>{if(s.getExtension(U)){const r=e.materialIndexMap.get(s),o=t.json.materials[r];o.extensions=o.extensions||{},o.extensions[U]={}}}),this}}P.EXTENSION_NAME=U;const B="KHR_mesh_quantization";class V extends e{constructor(){super(...arguments),this.extensionName=B}read(e){return this}write(e){return this}}V.EXTENSION_NAME=B;const q="KHR_texture_basisu";class z extends e{constructor(){super(...arguments),this.extensionName=q,this.provideTypes=[t.TEXTURE]}provide(e){return e.jsonDoc.json.textures.forEach(e=>{e.extensions&&e.extensions[q]&&(e.source=e.extensions[q].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(s=>{if("image/ktx2"===s.getMimeType()){const r=e.imageIndexMap.get(s);t.json.textures.forEach(e=>{e.source===r&&(e.extensions=e.extensions||{},e.extensions[q]={source:e.source},delete e.source)})}}),this}}z.EXTENSION_NAME=q;class Y extends r{constructor(){super(...arguments),this.propertyType="Transform",this.parentTypes=[t.TEXTURE_INFO],this.extensionName="KHR_texture_transform",this._offset=[0,0],this._rotation=0,this._scale=[1,1],this._texCoord=void 0}copy(e,t=o){return super.copy(e,t),this._offset=e._offset,this._rotation=e._rotation,this._scale=e._scale,this._texCoord=e._texCoord,this}getOffset(){return this._offset}setOffset(e){return this._offset=e,this}getRotation(){return this._rotation}setRotation(e){return this._rotation=e,this}getScale(){return this._scale}setScale(e){return this._scale=e,this}getTexCoord(){return this._texCoord}setTexCoord(e){return this._texCoord=e,this}}Y.EXTENSION_NAME="KHR_texture_transform";const $="KHR_texture_transform";class W extends e{constructor(){super(...arguments),this.extensionName=$}createTransform(){return new Y(this.doc.getGraph(),this)}read(e){for(const[t,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions[$])continue;const e=this.createTransform(),r=s.extensions[$];void 0!==r.offset&&e.setOffset(r.offset),void 0!==r.rotation&&e.setRotation(r.rotation),void 0!==r.scale&&e.setScale(r.scale),void 0!==r.texCoord&&e.setTexCoord(r.texCoord),t.setExtension($,e)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[e,s]of t){const t=e.getExtension($);t&&(s.extensions=s.extensions||{},s.extensions[$]={offset:t.getOffset(),rotation:t.getRotation(),scale:t.getScale(),texCoord:t.getTexCoord()})}return this}}W.EXTENSION_NAME=$;const J=[d,I,y,A,v,K,G,k,P,V,z,W],Q=[u,...J];export{Q as ALL_EXTENSIONS,N as Clearcoat,d as DracoMeshCompression,F as IOR,J as KHRONOS_EXTENSIONS,m as Light,_ as LightType,I as LightsPunctual,y as MaterialsClearcoat,A as MaterialsIOR,v as MaterialsPBRSpecularGlossiness,G as MaterialsSheen,K as MaterialsSpecular,k as MaterialsTransmission,P as MaterialsUnlit,V as MeshQuantization,M as PBRSpecularGlossiness,j as Sheen,O as Specular,z as TextureBasisu,W as TextureTransform,u as TextureWebP,Y as Transform,b as Transmission,L as Unlit};
//# sourceMappingURL=extensions.modern.js.map
