var e=require("@gltf-transform/core");function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function n(e){var t=0;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(e){if("string"==typeof e)return o(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,void 0):void 0}}(e)))return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=e[Symbol.iterator]()).next.bind(t)}var s,i,a,u="EXT_texture_webp",c=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).extensionName=u,t.provideTypes=[e.PropertyType.TEXTURE],t}t(o,r);var n=o.prototype;return n.provide=function(e){return e.jsonDoc.json.textures.forEach(function(e){e.extensions&&e.extensions[u]&&(e.source=e.extensions[u].source)}),this},n.read=function(e){return this},n.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(function(r){if("image/webp"===r.getMimeType()){var o=e.imageIndexMap.get(r);t.json.textures.forEach(function(e){e.source===o&&(e.extensions=e.extensions||{},e.extensions[u]={source:e.source},delete e.source)})}}),this},o}(e.Extension);function l(e,t){var r;try{if((r=new s.DecoderBuffer).Init(new Int8Array(t),t.byteLength),e.GetEncodedGeometryType(r)!==s.TRIANGULAR_MESH)throw new Error("Unknown geometry type.");var o=new s.Mesh;if(!e.DecodeBufferToMesh(r,o).ok()||0===o.ptr)throw new Error("Decoding failure.");return o}finally{s.destroy(r)}}function h(e,t){var r=3*t.num_faces(),o=r*Uint32Array.BYTES_PER_ELEMENT,n=s._malloc(o);e.GetTrianglesUInt32Array(t,o,n);var i=new Uint32Array(s.HEAP32.buffer,n,r).slice();return s._free(n),i}function f(e,t,r,o){var n=a[o.componentType],u=i[o.componentType],c=r.num_components(),l=t.num_points()*c,h=l*u.BYTES_PER_ELEMENT,f=s._malloc(h);e.GetAttributeDataArrayForAllPoints(t,r,n,h,f);var x=new u(s.HEAPF32.buffer,f,l).slice();return s._free(f),x}c.EXTENSION_NAME=u;var x,p="KHR_draco_mesh_compression",T=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).extensionName=p,t.provideTypes=[e.PropertyType.PRIMITIVE],t.dependencies=["draco3d.decoder"],t}t(o,r);var u=o.prototype;return u.install=function(e,t){var r,o;return"draco3d.decoder"===e&&(this._decoderModule=t,s=this._decoderModule,(r={})[5126]=Float32Array,r[5125]=Uint32Array,r[5123]=Uint16Array,r[5121]=Uint8Array,r[5122]=Int16Array,r[5120]=Int8Array,i=r,(o={})[5126]=s.DT_FLOAT32,o[5125]=s.DT_UINT32,o[5123]=s.DT_UINT16,o[5121]=s.DT_UINT8,o[5122]=s.DT_INT16,o[5120]=s.DT_INT8,a=o),this},u.provide=function(t){if(!this._decoderModule)throw new Error('Please install extension dependency, "draco3d.decoder".');for(var r,o=this.doc.getLogger(),s=t.jsonDoc,i=new this._decoderModule.Decoder,a=new Map,u=n(s.json.meshes);!(r=u()).done;){for(var c,x=n(r.value.primitives);!(c=x()).done;){var T=c.value;if(T.extensions&&T.extensions[p]){var g=T.extensions[p],d=a.get(g.bufferView);if(!d){var y=s.json.bufferViews[g.bufferView],_=s.json.buffers[y.buffer],v=new Uint8Array(_.uri?s.resources[_.uri]:s.resources[e.GLB_BUFFER],y.byteOffset||0,y.byteLength);d=l(i,v),a.set(g.bufferView,d),o.debug("Decompressed "+v.byteLength+" bytes.")}for(var C in T.attributes){var I=t.jsonDoc.json.accessors[T.attributes[C]],m=i.GetAttributeByUniqueId(d,g.attributes[C]),E=f(i,d,m,I);t.accessors[T.attributes[C]].setArray(E)}var R=h(i,d);t.accessors[T.indices].setArray(R)}}this._decoderModule.destroy(i);for(var N=0,F=Array.from(a.values());N<F.length;N++)this._decoderModule.destroy(F[N])}return this},u.read=function(e){return this.dispose(),this},u.write=function(e){return this.doc.getLogger().warn("Writing "+this.extensionName+" not yet implemented."),this},o}(e.Extension);T.EXTENSION_NAME=p,(x=exports.LightType||(exports.LightType={})).POINT="point",x.SPOT="spot",x.DIRECTIONAL="directional";var g=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).propertyType="Light",t.parentTypes=[e.PropertyType.NODE],t.extensionName="KHR_lights_punctual",t._color=[1,1,1],t._intensity=1,t._range=void 0,t._innerConeAngle=0,t._outerConeAngle=Math.PI/4,t}t(o,r);var n=o.prototype;return n.copy=function(t,o){return void 0===o&&(o=e.COPY_IDENTITY),r.prototype.copy.call(this,t,o),this._color=[].concat(t._color),this._intensity=t._intensity,this._type=t._type,this._range=t._range,this._innerConeAngle=t._innerConeAngle,this._outerConeAngle=t._outerConeAngle,this},n.getColor=function(){return this._color},n.setColor=function(e){return this._color=e,this},n.getColorHex=function(){return e.ColorUtils.factorToHex(this._color)},n.setColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._color),this},n.getIntensity=function(){return this._intensity},n.setIntensity=function(e){return this._intensity=e,this},n.getType=function(){return this._type},n.setType=function(e){return this._type=e,this},n.getRange=function(){return this._range},n.setRange=function(e){return this._range=e,this},n.getInnerConeAngle=function(){return this._innerConeAngle},n.setInnerConeAngle=function(e){return this._innerConeAngle=e,this},n.getOuterConeAngle=function(){return this._outerConeAngle},n.setOuterConeAngle=function(e){return this._outerConeAngle=e,this},o}(e.ExtensionProperty);g.EXTENSION_NAME="KHR_lights_punctual";var d="KHR_lights_punctual",y=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=d,t}t(r,e);var o=r.prototype;return o.createLight=function(){return new g(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[d])return this;var o=(r.json.extensions[d].lights||[]).map(function(e){var r=t.createLight().setName(e.name||"").setType(e.type);return void 0!==e.color&&r.setColor(e.color),void 0!==e.intensity&&r.setIntensity(e.intensity),void 0!==e.range&&r.setRange(e.range),void 0!==e.innerConeAngle&&r.setInnerConeAngle(e.innerConeAngle),void 0!==e.outerConeAngle&&r.setOuterConeAngle(e.outerConeAngle),r});return r.json.nodes.forEach(function(t,r){t.extensions&&t.extensions[d]&&e.nodes[r].setExtension(d,o[t.extensions[d].light])}),this},o.write=function(e){var t=e.jsonDoc;if(0===this.properties.size)return this;for(var r,o=[],s=new Map,i=n(this.properties);!(r=i()).done;){var a=r.value,u={type:a.getType(),color:a.getColor(),intensity:a.getIntensity(),range:a.getRange()};a.getName()&&(u.name=a.getName()),a.getType()===exports.LightType.SPOT&&(u.innerConeAngle=a.getInnerConeAngle(),u.outerConeAngle=a.getOuterConeAngle()),o.push(u),s.set(a,o.length-1)}return this.doc.getRoot().listNodes().forEach(function(r){var o=r.getExtension(d);if(o){var n=e.nodeIndexMap.get(r),i=t.json.nodes[n];i.extensions=i.extensions||{},i.extensions[d]={light:s.get(o)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[d]={lights:o},this},r}(e.Extension);function _(e,t,r,o){var n,s=arguments.length,i=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,o);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(i=(s<3?n(i):s>3?n(t,r,i):n(t,r))||i);return s>3&&i&&Object.defineProperty(t,r,i),i}y.EXTENSION_NAME=d;var v=function(o){function n(){var t;return(t=o.apply(this,arguments)||this).propertyType="Clearcoat",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_clearcoat",t._clearcoatFactor=0,t._clearcoatRoughnessFactor=0,t._clearcoatNormalScale=1,t.clearcoatTexture=null,t.clearcoatTextureInfo=t.graph.link("clearcoatTextureInfo",r(t),new e.TextureInfo(t.graph)),t.clearcoatRoughnessTexture=null,t.clearcoatRoughnessTextureInfo=t.graph.link("clearcoatRoughnessTextureInfo",r(t),new e.TextureInfo(t.graph)),t.clearcoatNormalTexture=null,t.clearcoatNormalTextureInfo=t.graph.link("clearcoatNormalTextureInfo",r(t),new e.TextureInfo(t.graph)),t}t(n,o);var s=n.prototype;return s.copy=function(t,r){return void 0===r&&(r=e.COPY_IDENTITY),o.prototype.copy.call(this,t,r),this._clearcoatFactor=t._clearcoatFactor,this._clearcoatRoughnessFactor=t._clearcoatRoughnessFactor,this._clearcoatNormalScale=t._clearcoatNormalScale,t.clearcoatTexture&&(this.setClearcoatTexture(r(t.clearcoatTexture.getChild())),this.getClearcoatTextureInfo().copy(r(t.clearcoatTextureInfo.getChild()),r)),t.clearcoatRoughnessTexture&&(this.setClearcoatRoughnessTexture(r(t.clearcoatRoughnessTexture.getChild())),this.getClearcoatRoughnessTextureInfo().copy(r(t.clearcoatRoughnessTextureInfo.getChild()),r)),t.clearcoatNormalTexture&&(this.setClearcoatNormalTexture(r(t.clearcoatNormalTexture.getChild())),this.getClearcoatNormalTextureInfo().copy(r(t.clearcoatNormalTextureInfo.getChild()),r)),this},s.dispose=function(){this.clearcoatTextureInfo.getChild().dispose(),this.clearcoatRoughnessTextureInfo.getChild().dispose(),this.clearcoatNormalTextureInfo.getChild().dispose(),o.prototype.dispose.call(this)},s.getClearcoatFactor=function(){return this._clearcoatFactor},s.setClearcoatFactor=function(e){return this._clearcoatFactor=e,this},s.getClearcoatTexture=function(){return this.clearcoatTexture?this.clearcoatTexture.getChild():null},s.getClearcoatTextureInfo=function(){return this.clearcoatTexture?this.clearcoatTextureInfo.getChild():null},s.setClearcoatTexture=function(e){return this.clearcoatTexture=this.graph.link("clearcoatTexture",this,e),this},s.getClearcoatRoughnessFactor=function(){return this._clearcoatRoughnessFactor},s.setClearcoatRoughnessFactor=function(e){return this._clearcoatRoughnessFactor=e,this},s.getClearcoatRoughnessTexture=function(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTexture.getChild():null},s.getClearcoatRoughnessTextureInfo=function(){return this.clearcoatRoughnessTexture?this.clearcoatRoughnessTextureInfo.getChild():null},s.setClearcoatRoughnessTexture=function(e){return this.clearcoatRoughnessTexture=this.graph.link("clearcoatRoughnessTexture",this,e),this},s.getClearcoatNormalScale=function(){return this._clearcoatNormalScale},s.setClearcoatNormalScale=function(e){return this._clearcoatNormalScale=e,this},s.getClearcoatNormalTexture=function(){return this.clearcoatNormalTexture?this.clearcoatNormalTexture.getChild():null},s.getClearcoatNormalTextureInfo=function(){return this.clearcoatNormalTexture?this.clearcoatNormalTextureInfo.getChild():null},s.setClearcoatNormalTexture=function(e){return this.clearcoatNormalTexture=this.graph.link("clearcoatNormalTexture",this,e),this},n}(e.ExtensionProperty);v.EXTENSION_NAME="KHR_materials_clearcoat",_([e.GraphChild],v.prototype,"clearcoatTexture",void 0),_([e.GraphChild],v.prototype,"clearcoatTextureInfo",void 0),_([e.GraphChild],v.prototype,"clearcoatRoughnessTexture",void 0),_([e.GraphChild],v.prototype,"clearcoatRoughnessTextureInfo",void 0),_([e.GraphChild],v.prototype,"clearcoatNormalTexture",void 0),_([e.GraphChild],v.prototype,"clearcoatNormalTextureInfo",void 0);var C="KHR_materials_clearcoat",I=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=C,t}t(r,e);var o=r.prototype;return o.createClearcoat=function(){return new v(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,o=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[C]){var s=t.createClearcoat();if(e.materials[n].setExtension(C,s),void 0!==r.extensions[C].clearcoatFactor&&s.setClearcoatFactor(r.extensions[C].clearcoatFactor),void 0!==r.extensions[C].clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(r.extensions[C].clearcoatRoughnessFactor),void 0!==r.extensions[C].clearcoatTexture){var i=r.extensions[C].clearcoatTexture;s.setClearcoatTexture(e.textures[o[i.index].source]),e.setTextureInfo(s.getClearcoatTextureInfo(),i)}if(void 0!==r.extensions[C].clearcoatRoughnessTexture){var a=r.extensions[C].clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(e.textures[o[a.index].source]),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),a)}if(void 0!==r.extensions[C].clearcoatNormalTexture){var u=r.extensions[C].clearcoatNormalTexture;s.setClearcoatNormalTexture(e.textures[o[u.index].source]),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),u),void 0!==u.scale&&s.setClearcoatNormalScale(u.scale)}}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(C);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];if(s.extensions=s.extensions||{},s.extensions[C]={clearcoatFactor:o.getClearcoatFactor(),clearcoatRoughnessFactor:o.getClearcoatRoughnessFactor()},o.getClearcoatTexture()){var i=o.getClearcoatTexture(),a=o.getClearcoatTextureInfo();s.extensions[C].clearcoatTexture=e.createTextureInfoDef(i,a)}if(o.getClearcoatRoughnessTexture()){var u=o.getClearcoatRoughnessTexture(),c=o.getClearcoatRoughnessTextureInfo();s.extensions[C].clearcoatRoughnessTexture=e.createTextureInfoDef(u,c)}if(o.getClearcoatNormalTexture()){var l=o.getClearcoatNormalTexture(),h=o.getClearcoatNormalTextureInfo();s.extensions[C].clearcoatNormalTexture=e.createTextureInfoDef(l,h),1!==o.getClearcoatNormalScale()&&(s.extensions[C].clearcoatNormalTexture.scale=o.getClearcoatNormalScale())}}}),this},r}(e.Extension);I.EXTENSION_NAME=C;var m=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).propertyType="IOR",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_ior",t._ior=0,t}t(o,r);var n=o.prototype;return n.copy=function(t,o){return void 0===o&&(o=e.COPY_IDENTITY),r.prototype.copy.call(this,t,o),this._ior=t._ior,this},n.getIOR=function(){return this._ior},n.setIOR=function(e){return this._ior=e,this},o}(e.ExtensionProperty);m.EXTENSION_NAME="KHR_materials_ior";var E="KHR_materials_ior",R=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=E,t}t(r,e);var o=r.prototype;return o.createIOR=function(){return new m(this.doc.getGraph(),this)},o.read=function(e){var t=this;return(e.jsonDoc.json.materials||[]).forEach(function(r,o){if(r.extensions&&r.extensions[E]){var n=t.createIOR();e.materials[o].setExtension(E,n),void 0!==r.extensions[E].ior&&n.setIOR(r.extensions[E].ior)}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(E);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];s.extensions=s.extensions||{},s.extensions[E]={ior:o.getIOR()}}}),this},r}(e.Extension);R.EXTENSION_NAME=E;var N=function(o){function n(){var t;return(t=o.apply(this,arguments)||this).propertyType="PBRSpecularGlossiness",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_pbrSpecularGlossiness",t._diffuseFactor=[1,1,1,1],t._specularFactor=[1,1,1],t._glossinessFactor=1,t.diffuseTexture=null,t.diffuseTextureInfo=t.graph.link("diffuseTextureInfo",r(t),new e.TextureInfo(t.graph)),t.specularGlossinessTexture=null,t.specularGlossinessTextureInfo=t.graph.link("specularGlossinessTextureInfo",r(t),new e.TextureInfo(t.graph)),t}t(n,o);var s=n.prototype;return s.copy=function(t,r){return void 0===r&&(r=e.COPY_IDENTITY),o.prototype.copy.call(this,t,r),this._diffuseFactor=t._diffuseFactor,this._specularFactor=t._specularFactor,this._glossinessFactor=t._glossinessFactor,t.diffuseTexture&&(this.setDiffuseTexture(r(t.diffuseTexture.getChild())),this.getDiffuseTextureInfo().copy(r(t.diffuseTextureInfo.getChild()),r)),t.specularGlossinessTexture&&(this.setSpecularGlossinessTexture(r(t.specularGlossinessTexture.getChild())),this.getSpecularGlossinessTextureInfo().copy(r(t.specularGlossinessTextureInfo.getChild()),r)),this},s.dispose=function(){this.diffuseTextureInfo.getChild().dispose(),this.specularGlossinessTextureInfo.getChild().dispose(),o.prototype.dispose.call(this)},s.getDiffuseFactor=function(){return this._diffuseFactor},s.setDiffuseFactor=function(e){return this._diffuseFactor=e,this},s.getDiffuseHex=function(){return e.ColorUtils.factorToHex(this._diffuseFactor)},s.setDiffuseHex=function(t){return e.ColorUtils.hexToFactor(t,this._diffuseFactor),this},s.getDiffuseTexture=function(){return this.diffuseTexture?this.diffuseTexture.getChild():null},s.getDiffuseTextureInfo=function(){return this.diffuseTexture?this.diffuseTextureInfo.getChild():null},s.setDiffuseTexture=function(e){return this.diffuseTexture=this.graph.link("diffuseTexture",this,e),this},s.getSpecularFactor=function(){return this._specularFactor},s.setSpecularFactor=function(e){return this._specularFactor=e,this},s.getGlossinessFactor=function(){return this._glossinessFactor},s.setGlossinessFactor=function(e){return this._glossinessFactor=e,this},s.getSpecularGlossinessTexture=function(){return this.specularGlossinessTexture?this.specularGlossinessTexture.getChild():null},s.getSpecularGlossinessTextureInfo=function(){return this.specularGlossinessTexture?this.specularGlossinessTextureInfo.getChild():null},s.setSpecularGlossinessTexture=function(e){return this.specularGlossinessTexture=this.graph.link("specularGlossinessTexture",this,e),this},n}(e.ExtensionProperty);N.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness",_([e.GraphChild],N.prototype,"diffuseTexture",void 0),_([e.GraphChild],N.prototype,"diffuseTextureInfo",void 0),_([e.GraphChild],N.prototype,"specularGlossinessTexture",void 0),_([e.GraphChild],N.prototype,"specularGlossinessTextureInfo",void 0);var F="KHR_materials_pbrSpecularGlossiness",S=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=F,t}t(r,e);var o=r.prototype;return o.createPBRSpecularGlossiness=function(){return new N(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,o=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[F]){var s=t.createPBRSpecularGlossiness();if(e.materials[n].setExtension(F,s),void 0!==r.extensions[F].diffuseFactor&&s.setDiffuseFactor(r.extensions[F].diffuseFactor),void 0!==r.extensions[F].specularFactor&&s.setSpecularFactor(r.extensions[F].specularFactor),void 0!==r.extensions[F].glossinessFactor&&s.setGlossinessFactor(r.extensions[F].glossinessFactor),void 0!==r.extensions[F].diffuseTexture){var i=r.extensions[F].diffuseTexture;s.setDiffuseTexture(e.textures[o[i.index].source]),e.setTextureInfo(s.getDiffuseTextureInfo(),i)}if(void 0!==r.extensions[F].specularGlossinessTexture){var a=r.extensions[F].specularGlossinessTexture;s.setSpecularGlossinessTexture(e.textures[o[a.index].source]),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),a)}}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(F);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];if(s.extensions=s.extensions||{},s.extensions[F]={diffuseFactor:o.getDiffuseFactor(),specularFactor:o.getSpecularFactor(),glossinessFactor:o.getGlossinessFactor()},o.getDiffuseTexture()){var i=o.getDiffuseTexture(),a=o.getDiffuseTextureInfo();s.extensions[F].diffuseTexture=e.createTextureInfoDef(i,a)}if(o.getSpecularGlossinessTexture()){var u=o.getSpecularGlossinessTexture(),c=o.getSpecularGlossinessTextureInfo();s.extensions[F].specularGlossinessTexture=e.createTextureInfoDef(u,c)}}}),this},r}(e.Extension);S.EXTENSION_NAME=F;var A=function(o){function n(){var t;return(t=o.apply(this,arguments)||this).propertyType="Sheen",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_sheen",t._sheenColorFactor=[0,0,0],t._sheenRoughnessFactor=0,t.sheenColorTexture=null,t.sheenColorTextureInfo=t.graph.link("sheenColorTextureInfo",r(t),new e.TextureInfo(t.graph)),t.sheenRoughnessTexture=null,t.sheenRoughnessTextureInfo=t.graph.link("sheenRoughnessTextureInfo",r(t),new e.TextureInfo(t.graph)),t}t(n,o);var s=n.prototype;return s.copy=function(t,r){return void 0===r&&(r=e.COPY_IDENTITY),o.prototype.copy.call(this,t,r),this._sheenColorFactor=t._sheenColorFactor,this._sheenRoughnessFactor=t._sheenRoughnessFactor,t.sheenColorTexture&&(this.setSheenColorTexture(r(t.sheenColorTexture.getChild())),this.getSheenColorTextureInfo().copy(r(t.sheenColorTextureInfo.getChild()),r)),t.sheenRoughnessTexture&&(this.setSheenRoughnessTexture(r(t.sheenRoughnessTexture.getChild())),this.getSheenRoughnessTextureInfo().copy(r(t.sheenRoughnessTextureInfo.getChild()),r)),this},s.dispose=function(){this.sheenColorTextureInfo.getChild().dispose(),this.sheenRoughnessTextureInfo.getChild().dispose(),o.prototype.dispose.call(this)},s.getSheenColorFactor=function(){return this._sheenColorFactor},s.getSheenColorHex=function(){return e.ColorUtils.factorToHex(this._sheenColorFactor)},s.setSheenColorFactor=function(e){return this._sheenColorFactor=e,this},s.setSheenColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._sheenColorFactor),this},s.getSheenColorTexture=function(){return this.sheenColorTexture?this.sheenColorTexture.getChild():null},s.getSheenColorTextureInfo=function(){return this.sheenColorTexture?this.sheenColorTextureInfo.getChild():null},s.setSheenColorTexture=function(e){return this.sheenColorTexture=this.graph.link("sheenColorTexture",this,e),this},s.getSheenRoughnessFactor=function(){return this._sheenRoughnessFactor},s.setSheenRoughnessFactor=function(e){return this._sheenRoughnessFactor=e,this},s.getSheenRoughnessTexture=function(){return this.sheenRoughnessTexture?this.sheenRoughnessTexture.getChild():null},s.getSheenRoughnessTextureInfo=function(){return this.sheenRoughnessTexture?this.sheenRoughnessTextureInfo.getChild():null},s.setSheenRoughnessTexture=function(e){return this.sheenRoughnessTexture=this.graph.link("sheenRoughnessTexture",this,e),this},n}(e.ExtensionProperty);A.EXTENSION_NAME="KHR_materials_sheen",_([e.GraphChild],A.prototype,"sheenColorTexture",void 0),_([e.GraphChild],A.prototype,"sheenColorTextureInfo",void 0),_([e.GraphChild],A.prototype,"sheenRoughnessTexture",void 0),_([e.GraphChild],A.prototype,"sheenRoughnessTextureInfo",void 0);var G="KHR_materials_sheen",M=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=G,t}t(r,e);var o=r.prototype;return o.createSheen=function(){return new A(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,o=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[G]){var s=t.createSheen();if(e.materials[n].setExtension(G,s),void 0!==r.extensions[G].sheenColorFactor&&s.setSheenColorFactor(r.extensions[G].sheenColorFactor),void 0!==r.extensions[G].sheenRoughnessFactor&&s.setSheenRoughnessFactor(r.extensions[G].sheenRoughnessFactor),void 0!==r.extensions[G].sheenColorTexture){var i=r.extensions[G].sheenColorTexture;s.setSheenColorTexture(e.textures[o[i.index].source]),e.setTextureInfo(s.getSheenColorTextureInfo(),i)}if(void 0!==r.extensions[G].sheenRoughnessTexture){var a=r.extensions[G].sheenRoughnessTexture;s.setSheenRoughnessTexture(e.textures[o[a.index].source]),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),a)}}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(G);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];if(s.extensions=s.extensions||{},s.extensions[G]={sheenColorFactor:o.getSheenColorFactor(),sheenRoughnessFactor:o.getSheenRoughnessFactor()},o.getSheenColorTexture()){var i=o.getSheenColorTexture(),a=o.getSheenColorTextureInfo();s.extensions[G].sheenColorTexture=e.createTextureInfoDef(i,a)}if(o.getSheenRoughnessTexture()){var u=o.getSheenRoughnessTexture(),c=o.getSheenRoughnessTextureInfo();s.extensions[G].sheenRoughnessTexture=e.createTextureInfoDef(u,c)}}}),this},r}(e.Extension);M.EXTENSION_NAME=G;var D=function(o){function n(){var t;return(t=o.apply(this,arguments)||this).propertyType="Specular",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_specular",t._specularFactor=1,t._specularColorFactor=[1,1,1],t.specularTexture=null,t.specularTextureInfo=t.graph.link("specularTextureInfo",r(t),new e.TextureInfo(t.graph)),t}t(n,o);var s=n.prototype;return s.copy=function(t,r){return void 0===r&&(r=e.COPY_IDENTITY),o.prototype.copy.call(this,t,r),this._specularFactor=t._specularFactor,t.specularTexture&&(this.setSpecularTexture(r(t.specularTexture.getChild())),this.getSpecularTextureInfo().copy(r(t.specularTextureInfo.getChild()),r)),this},s.dispose=function(){this.specularTextureInfo.getChild().dispose(),o.prototype.dispose.call(this)},s.getSpecularFactor=function(){return this._specularFactor},s.setSpecularFactor=function(e){return this._specularFactor=e,this},s.getSpecularColorFactor=function(){return this._specularColorFactor},s.setSpecularColorFactor=function(e){return this._specularColorFactor=e,this},s.getSpecularColorHex=function(){return e.ColorUtils.factorToHex(this._specularColorFactor)},s.setSpecularColorHex=function(t){return e.ColorUtils.hexToFactor(t,this._specularColorFactor),this},s.getSpecularTexture=function(){return this.specularTexture?this.specularTexture.getChild():null},s.getSpecularTextureInfo=function(){return this.specularTexture?this.specularTextureInfo.getChild():null},s.setSpecularTexture=function(e){return this.specularTexture=this.graph.link("specularTexture",this,e),this},n}(e.ExtensionProperty);D.EXTENSION_NAME="KHR_materials_specular",_([e.GraphChild],D.prototype,"specularTexture",void 0),_([e.GraphChild],D.prototype,"specularTextureInfo",void 0);var O="KHR_materials_specular",j=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=O,t}t(r,e);var o=r.prototype;return o.createSpecular=function(){return new D(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,o=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[O]){var s=t.createSpecular();if(e.materials[n].setExtension(O,s),void 0!==r.extensions[O].specularFactor&&s.setSpecularFactor(r.extensions[O].specularFactor),void 0!==r.extensions[O].specularColorFactor&&s.setSpecularColorFactor(r.extensions[O].specularColorFactor),void 0!==r.extensions[O].specularTexture){var i=r.extensions[O].specularTexture;s.setSpecularTexture(e.textures[o[i.index].source]),e.setTextureInfo(s.getSpecularTextureInfo(),i)}}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(O);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];if(s.extensions=s.extensions||{},s.extensions[O]={specularFactor:o.getSpecularFactor(),specularColorFactor:o.getSpecularColorFactor()},o.getSpecularTexture()){var i=o.getSpecularTexture(),a=o.getSpecularTextureInfo();s.extensions[O].specularTexture=e.createTextureInfoDef(i,a)}}}),this},r}(e.Extension);j.EXTENSION_NAME=O;var w=function(o){function n(){var t;return(t=o.apply(this,arguments)||this).propertyType="Transmission",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_transmission",t._transmissionFactor=0,t.transmissionTexture=null,t.transmissionTextureInfo=t.graph.link("transmissionTextureInfo",r(t),new e.TextureInfo(t.graph)),t}t(n,o);var s=n.prototype;return s.copy=function(t,r){return void 0===r&&(r=e.COPY_IDENTITY),o.prototype.copy.call(this,t,r),this._transmissionFactor=t._transmissionFactor,t.transmissionTexture&&(this.setTransmissionTexture(r(t.transmissionTexture.getChild())),this.getTransmissionTextureInfo().copy(r(t.transmissionTextureInfo.getChild()),r)),this},s.dispose=function(){this.transmissionTextureInfo.getChild().dispose(),o.prototype.dispose.call(this)},s.getTransmissionFactor=function(){return this._transmissionFactor},s.setTransmissionFactor=function(e){return this._transmissionFactor=e,this},s.getTransmissionTexture=function(){return this.transmissionTexture?this.transmissionTexture.getChild():null},s.getTransmissionTextureInfo=function(){return this.transmissionTexture?this.transmissionTextureInfo.getChild():null},s.setTransmissionTexture=function(e){return this.transmissionTexture=this.graph.link("transmissionTexture",this,e),this},n}(e.ExtensionProperty);w.EXTENSION_NAME="KHR_materials_transmission",_([e.GraphChild],w.prototype,"transmissionTexture",void 0),_([e.GraphChild],w.prototype,"transmissionTextureInfo",void 0);var P="KHR_materials_transmission",H=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=P,t}t(r,e);var o=r.prototype;return o.createTransmission=function(){return new w(this.doc.getGraph(),this)},o.read=function(e){var t=this,r=e.jsonDoc,o=r.json.textures||[];return(r.json.materials||[]).forEach(function(r,n){if(r.extensions&&r.extensions[P]){var s=t.createTransmission();if(e.materials[n].setExtension(P,s),void 0!==r.extensions[P].transmissionFactor&&s.setTransmissionFactor(r.extensions[P].transmissionFactor),void 0!==r.extensions[P].transmissionTexture){var i=r.extensions[P].transmissionTexture;s.setTransmissionTexture(e.textures[o[i.index].source]),e.setTextureInfo(s.getTransmissionTextureInfo(),i)}}}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){var o=r.getExtension(P);if(o){var n=e.materialIndexMap.get(r),s=t.json.materials[n];if(s.extensions=s.extensions||{},s.extensions[P]={transmissionFactor:o.getTransmissionFactor()},o.getTransmissionTexture()){var i=o.getTransmissionTexture(),a=o.getTransmissionTextureInfo();s.extensions[P].transmissionTexture=e.createTextureInfoDef(i,a)}}}),this},r}(e.Extension);H.EXTENSION_NAME=P;var b=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).propertyType="Unlit",t.parentTypes=[e.PropertyType.MATERIAL],t.extensionName="KHR_materials_unlit",t}return t(o,r),o}(e.ExtensionProperty);b.EXTENSION_NAME="KHR_materials_unlit";var K="KHR_materials_unlit",U=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=K,t}t(r,e);var o=r.prototype;return o.createUnlit=function(){return new b(this.doc.getGraph(),this)},o.read=function(e){var t=this;return(e.jsonDoc.json.materials||[]).forEach(function(r,o){r.extensions&&r.extensions[K]&&e.materials[o].setExtension(K,t.createUnlit())}),this},o.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listMaterials().forEach(function(r){if(r.getExtension(K)){var o=e.materialIndexMap.get(r),n=t.json.materials[o];n.extensions=n.extensions||{},n.extensions[K]={}}}),this},r}(e.Extension);U.EXTENSION_NAME=K;var L="KHR_mesh_quantization",X=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=L,t}t(r,e);var o=r.prototype;return o.read=function(e){return this},o.write=function(e){return this},r}(e.Extension);X.EXTENSION_NAME=L;var k="KHR_texture_basisu",Y=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).extensionName=k,t.provideTypes=[e.PropertyType.TEXTURE],t}t(o,r);var n=o.prototype;return n.provide=function(e){return e.jsonDoc.json.textures.forEach(function(e){e.extensions&&e.extensions[k]&&(e.source=e.extensions[k].source)}),this},n.read=function(e){return this},n.write=function(e){var t=e.jsonDoc;return this.doc.getRoot().listTextures().forEach(function(r){if("image/ktx2"===r.getMimeType()){var o=e.imageIndexMap.get(r);t.json.textures.forEach(function(e){e.source===o&&(e.extensions=e.extensions||{},e.extensions[k]={source:e.source},delete e.source)})}}),this},o}(e.Extension);Y.EXTENSION_NAME=k;var B=function(r){function o(){var t;return(t=r.apply(this,arguments)||this).propertyType="Transform",t.parentTypes=[e.PropertyType.TEXTURE_INFO],t.extensionName="KHR_texture_transform",t._offset=[0,0],t._rotation=0,t._scale=[1,1],t._texCoord=void 0,t}t(o,r);var n=o.prototype;return n.copy=function(t,o){return void 0===o&&(o=e.COPY_IDENTITY),r.prototype.copy.call(this,t,o),this._offset=t._offset,this._rotation=t._rotation,this._scale=t._scale,this._texCoord=t._texCoord,this},n.getOffset=function(){return this._offset},n.setOffset=function(e){return this._offset=e,this},n.getRotation=function(){return this._rotation},n.setRotation=function(e){return this._rotation=e,this},n.getScale=function(){return this._scale},n.setScale=function(e){return this._scale=e,this},n.getTexCoord=function(){return this._texCoord},n.setTexCoord=function(e){return this._texCoord=e,this},o}(e.ExtensionProperty);B.EXTENSION_NAME="KHR_texture_transform";var V="KHR_texture_transform",q=function(e){function r(){var t;return(t=e.apply(this,arguments)||this).extensionName=V,t}t(r,e);var o=r.prototype;return o.createTransform=function(){return new B(this.doc.getGraph(),this)},o.read=function(e){for(var t=0,r=Array.from(e.textureInfos.entries());t<r.length;t++){var o=r[t],n=o[0],s=o[1];if(s.extensions&&s.extensions[V]){var i=this.createTransform(),a=s.extensions[V];void 0!==a.offset&&i.setOffset(a.offset),void 0!==a.rotation&&i.setRotation(a.rotation),void 0!==a.scale&&i.setScale(a.scale),void 0!==a.texCoord&&i.setTexCoord(a.texCoord),n.setExtension(V,i)}}return this},o.write=function(e){for(var t=0,r=Array.from(e.textureInfoDefMap.entries());t<r.length;t++){var o=r[t],n=o[1],s=o[0].getExtension(V);s&&(n.extensions=n.extensions||{},n.extensions[V]={offset:s.getOffset(),rotation:s.getRotation(),scale:s.getScale(),texCoord:s.getTexCoord()})}return this},r}(e.Extension);q.EXTENSION_NAME=V;var z=[T,y,I,R,S,j,M,H,U,X,Y,q],W=[c].concat(z);exports.ALL_EXTENSIONS=W,exports.Clearcoat=v,exports.DracoMeshCompression=T,exports.IOR=m,exports.KHRONOS_EXTENSIONS=z,exports.Light=g,exports.LightsPunctual=y,exports.MaterialsClearcoat=I,exports.MaterialsIOR=R,exports.MaterialsPBRSpecularGlossiness=S,exports.MaterialsSheen=M,exports.MaterialsSpecular=j,exports.MaterialsTransmission=H,exports.MaterialsUnlit=U,exports.MeshQuantization=X,exports.PBRSpecularGlossiness=N,exports.Sheen=A,exports.Specular=D,exports.TextureBasisu=Y,exports.TextureTransform=q,exports.TextureWebP=c,exports.Transform=B,exports.Transmission=w,exports.Unlit=b;
//# sourceMappingURL=extensions.js.map
