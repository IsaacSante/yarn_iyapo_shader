var t,n=require("gl-matrix/mat4");function r(){return(r=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t}).apply(this,arguments)}function i(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}function e(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=t[r];return i}function s(t){var n=0;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,n){if(t){if("string"==typeof t)return u(t,void 0);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,void 0):void 0}}(t)))return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function o(t,n,r,i){var e,u=arguments.length,s=u<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,n,r,i);else for(var o=t.length-1;o>=0;o--)(e=t[o])&&(s=(u<3?e(s):u>3?e(n,r,s):e(n,r))||s);return u>3&&s&&Object.defineProperty(n,r,s),s}(t=exports.PropertyType||(exports.PropertyType={})).ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo";var h=function(){function t(t,n,r){if(this.t=t,this.i=n,this.u=r,this.h=!1,this.l=[],!n.canLink(r))throw new Error("Cannot link disconnected graphs/documents.")}var n=t.prototype;return n.getName=function(){return this.t},n.getParent=function(){return this.i},n.getChild=function(){return this.u},n.setChild=function(t){return this.u=t,this},n.dispose=function(){this.h||(this.h=!0,this.l.forEach(function(t){return t()}),this.l.length=0)},n.onDispose=function(t){return this.l.push(t),this},n.isDisposed=function(){return this.h},t}(),f=new Set,c=function(){function t(){this.p=new Set,this.A=new Map,this.m=new Map}var n=t.prototype;return n.getLinks=function(){return Array.from(this.p)},n.listParents=function(t){var n=this.m.get(t)||f;return Array.from(n).map(function(t){return t.getParent()})},n.listChildren=function(t){var n=this.A.get(t)||f;return Array.from(n).map(function(t){return t.getChild()})},n.disconnectChildren=function(t){return(this.A.get(t)||f).forEach(function(t){return t.dispose()}),this},n.disconnectParents=function(t,n){var r=Array.from(this.m.get(t)||f);return n&&(r=r.filter(function(t){return n(t.getParent())})),r.forEach(function(t){return t.dispose()}),this},n.swapChild=function(t,n,r){var i=this,e=this.A.get(t)||f;return Array.from(e).filter(function(t){return t.getChild()===n}).forEach(function(t){i.m.get(n).delete(t),t.setChild(r),i.m.has(r)||i.m.set(r,new Set),i.m.get(r).add(t)}),this},n.link=function(t,n,r){if(!r)return null;var i=new h(t,n,r);return this.registerLink(i),i},n.registerLink=function(t){var n=this;this.p.add(t);var r=t.getParent();this.A.has(r)||this.A.set(r,new Set),this.A.get(r).add(t);var i=t.getChild();return this.m.has(i)||this.m.set(i,new Set),this.m.get(i).add(t),t.onDispose(function(){return n.unlink(t)}),t},n.unlink=function(t){return this.p.delete(t),this.A.get(t.getParent()).delete(t),this.m.get(t.getChild()).delete(t),this},t}();function a(t,n){Object.defineProperty(t,n,{get:function(){return this["__"+n]},set:function(t){var r=this,i=this["__"+n];i&&!Array.isArray(i)&&i.dispose(),t&&!Array.isArray(t)&&t.onDispose(function(){r["__"+n]=null}),this["__"+n]=t},enumerable:!0})}function v(t,n){}var l=function(){function t(t){this.h=!1,this.graph=t}var n=t.prototype;return n.canLink=function(t){return this.graph===t.graph},n.isDisposed=function(){return this.h},n.dispose=function(){this.graph.disconnectChildren(this),this.graph.disconnectParents(this),this.h=!0},n.detach=function(){return this.graph.disconnectParents(this),this},n.swap=function(t,n){return this.graph.swapChild(this,t,n),this},n.addGraphChild=function(t,n){return t.push(n),n.onDispose(function(){var r=t.filter(function(t){return t!==n});t.length=0;for(var i,e=s(r);!(i=e()).done;)t.push(i.value)}),this},n.removeGraphChild=function(t,n){return t.filter(function(t){return t.getChild()===n}).forEach(function(t){return t.dispose()}),this},n.clearGraphChildList=function(t){for(;t.length>0;)t[0].dispose();return this},n.listGraphParents=function(){return this.graph.listParents(this)},t}(),d=function(){function t(){}return t.createBufferFromDataURI=function(t){if("undefined"==typeof Buffer){for(var n=atob(t.split(",")[1]),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r.buffer}var e=t.split(",")[1],u=t.indexOf("base64")>=0;return this.trim(Buffer.from(e,u?"base64":"utf8"))},t.encodeText=function(t){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(t).buffer:this.trim(Buffer.from(t))},t.decodeText=function(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")},t.trim=function(t){var n=t.byteOffset;return t.buffer.slice(n,n+t.byteLength)},t.concat=function(t){for(var n,r=0,i=s(t);!(n=i()).done;)r+=n.value.byteLength;for(var e,u=new Uint8Array(r),o=0,h=s(t);!(e=h()).done;){var f=e.value;u.set(new Uint8Array(f),o),o+=f.byteLength}return u.buffer},t.pad=function(t,n){void 0===n&&(n=0);var r=this.padNumber(t.byteLength);if(r!==t.byteLength){var i=new Uint8Array(r);if(i.set(new Uint8Array(t)),0!==n)for(var e=t.byteLength;e<r;e++)i[e]=n;return i.buffer}return t},t.padNumber=function(t){return 4*Math.ceil(t/4)},t.equals=function(t,n){if(t===n)return!0;if(t.byteLength!==n.byteLength)return!1;for(var r=new DataView(t),i=new DataView(n),e=t.byteLength;e--;)if(r.getUint8(e)!==i.getUint8(e))return!1;return!0},t}(),w=function(){function t(){}return t.hexToFactor=function(t,n){return t=Math.floor(t),n[0]=(t>>16&255)/255,n[1]=(t>>8&255)/255,n[2]=(255&t)/255,this.convertSRGBToLinear(n,n)},t.factorToHex=function(t){var n=[].concat(t),r=this.convertLinearToSRGB(t,n);return 255*r[0]<<16^255*r[1]<<8^255*r[2]<<0},t.convertSRGBToLinear=function(t,n){for(var r=0;r<3;r++)n[r]=t[r]<.04045?.0773993808*t[r]:Math.pow(.9478672986*t[r]+.0521327014,2.4);return n},t.convertLinearToSRGB=function(t,n){for(var r=0;r<3;r++)n[r]=t[r]<.0031308?12.92*t[r]:1.055*Math.pow(t[r],.41666)-.055;return n},t}(),p=function(){function t(){}return t.basename=function(t){return t.split(/[\\/]/).pop().split(/[.]/).shift()},t.extension=function(t){return 0!==t.indexOf("data:")?t.split(/[\\/]/).pop().split(/[.]/).pop():0===t.indexOf("data:image/png")?"png":0===t.indexOf("data:image/jpeg")?"jpeg":"bin"},t}(),x=function(){function t(){}return t.getSizeJPEG=function(t){for(var n,r,i=new DataView(t,4);i.byteLength;){if(n=i.getUint16(0,!1),y(i,n),192===(r=i.getUint8(n+1))||193===r||194===r)return[i.getUint16(n+7,!1),i.getUint16(n+5,!1)];i=new DataView(t,i.byteOffset+n+2)}throw new TypeError("Invalid JPG, no size found")},t.getSizePNG=function(t){var n=new DataView(t);return"CgBI"===d.decodeText(t.slice(12,16))?[n.getUint32(32,!1),n.getUint32(36,!1)]:[n.getUint32(16,!1),n.getUint32(20,!1)]},t.mimeTypeToExtension=function(t){return"image/jpeg"===t?"jpg":t.split("/").pop()},t.extensionToMimeType=function(t){return"jpg"===t?"image/jpeg":"image/"+t},t}();function y(t,n){if(n>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==t.getUint8(n))throw new TypeError("Invalid JPG, marker table corrupted")}var b=function(){function t(){}return t.identity=function(t){return t},t.denormalize=function(t,n){switch(n){case 5126:return t;case 5123:return t/65535;case 5121:return t/255;case 5122:return Math.max(t/32767,-1);case 5120:return Math.max(t/127,-1)}},t.normalize=function(t,n){switch(n){case 5126:return t;case 5123:return Math.round(65535*t);case 5121:return Math.round(255*t);case 5122:return Math.round(32767*t);case 5120:return Math.round(127*t)}},t}(),A=function(){function t(t){this.verbosity=t}var n=t.prototype;return n.debug=function(n){this.verbosity<=t.Verbosity.DEBUG&&console.debug(n)},n.info=function(n){this.verbosity<=t.Verbosity.INFO&&console.info(n)},n.warn=function(n){this.verbosity<=t.Verbosity.WARN&&console.warn(n)},n.error=function(n){this.verbosity<=t.Verbosity.ERROR&&console.error(n)},t}();A.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},A.DEFAULT_INSTANCE=new A(A.Verbosity.INFO);var m="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",E=new Set,g=function(){for(var t="",n=0;n<6;n++)t+=m.charAt(Math.floor(Math.random()*m.length));return t},T=function(){for(var t=0;t<999;t++){var n=g();if(!E.has(n))return E.add(n),n}},M=function(t){return t},S=function(t){function n(n,r){var i;return void 0===r&&(r=""),(i=t.call(this,n)||this).g={},i.t="",i.t=r,i}i(n,t);var r=n.prototype;return r.getName=function(){return this.t},r.setName=function(t){return this.t=t,this},r.getExtras=function(){return this.g},r.setExtras=function(t){return this.g=t,this},r.clone=function(){return new(0,this.constructor)(this.graph).copy(this,M)},r.copy=function(t,n){return this.t=t.t,this.g=JSON.parse(JSON.stringify(t.g)),this},r.detach=function(){return this.graph.disconnectParents(this,function(t){return"Root"!==t.propertyType}),this},r.listParents=function(){return this.listGraphParents()},n}(l),I="Pass extension name (string) as lookup token, not a constructor.",R=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).extensions=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.clearGraphChildList(this.extensions),n.extensions.forEach(function(t){var n=t.getChild();i.setExtension(n.extensionName,r(n))}),this},r.getExtension=function(t){if("string"!=typeof t)throw new Error(I);var n=this.extensions.find(function(n){return n.getChild().extensionName===t});return n?n.getChild():null},r.setExtension=function(t,n){if("string"!=typeof t)throw new Error(I);var r=this.getExtension(t);return r&&this.removeGraphChild(this.extensions,r),n?(n.T(this),this.addGraphChild(this.extensions,this.graph.link(t,this,n))):this},r.listExtensions=function(){return this.extensions.map(function(t){return t.getChild()})},n}(S);o([v],R.prototype,"extensions",void 0);var N=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.ACCESSOR,n.M=null,n.S="SCALAR",n.I=null,n.R=!1,n.N=b.identity,n.O=b.identity,n.buffer=null,n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.M=n.M.slice(),this.S=n.S,this.I=n.I,this.R=n.R,this.N=n.N,this.O=n.O,n.buffer&&this.setBuffer(r(n.buffer.getChild())),this},n.getElementSize=function(t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Unexpected type: "+t)}},n.getComponentSize=function(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5125:case 5126:return 4;default:throw new Error("Unexpected component type: "+t)}},r.getMinNormalized=function(t){var n=this.getElementSize();this.getMin(t);for(var r=0;r<n;r++)t[r]=this.O(t[r]);return t},r.getMin=function(t){for(var n=this.getCount(),r=this.getElementSize(),i=0;i<r;i++)t[i]=Infinity;for(var e=0;e<n*r;e+=r)for(var u=0;u<r;u++){var s=this.M[e+u];Number.isFinite(s)&&(t[u]=Math.min(t[u],s))}return t},r.getMaxNormalized=function(t){var n=this.getElementSize();this.getMax(t);for(var r=0;r<n;r++)t[r]=this.O(t[r]);return t},r.getMax=function(t){for(var n=this.getCount(),r=this.getElementSize(),i=0;i<r;i++)t[i]=-Infinity;for(var e=0;e<n*r;e+=r)for(var u=0;u<r;u++){var s=this.M[e+u];Number.isFinite(s)&&(t[u]=Math.max(t[u],s))}return t},r.getCount=function(){return this.M.length/this.getElementSize()},r.getType=function(){return this.S},r.setType=function(t){return this.S=t,this},r.getElementSize=function(){return n.getElementSize(this.S)},r.getComponentSize=function(){return this.M.BYTES_PER_ELEMENT},r.getComponentType=function(){return this.I},r.getNormalized=function(){return this.R},r.setNormalized=function(t){var n=this;return this.R=t,t?(this.O=function(t){return b.denormalize(t,n.I)},this.N=function(t){return b.normalize(t,n.I)}):(this.O=b.identity,this.N=b.identity),this},r.getScalar=function(t){var n=this.getElementSize();return this.O(this.M[t*n])},r.setScalar=function(t,n){return this.M[t*this.getElementSize()]=this.N(n),this},r.getElement=function(t,n){for(var r=this.getElementSize(),i=0;i<r;i++)n[i]=this.O(this.M[t*r+i]);return n},r.setElement=function(t,n){for(var r=this.getElementSize(),i=0;i<r;i++)this.M[t*r+i]=this.N(n[i]);return this},r.getBuffer=function(){return this.buffer?this.buffer.getChild():null},r.setBuffer=function(t){return this.buffer=this.graph.link("buffer",this,t),this},r.getArray=function(){return this.M},r.setArray=function(t){return this.I=function(t){switch(t.constructor){case Float32Array:return 5126;case Uint32Array:return 5125;case Uint16Array:return 5123;case Uint8Array:return 5121;case Int16Array:return 5122;case Int8Array:return 5120;default:throw new Error("Unknown accessor componentType.")}}(t),this.M=t,this},r.getByteLength=function(){return this.M.byteLength},n}(R);N.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT3:"MAT3",MAT4:"MAT4"},N.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126},o([a],N.prototype,"buffer",void 0);var O=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.ANIMATION,n.channels=[],n.samplers=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.clearGraphChildList(this.channels),this.clearGraphChildList(this.samplers),n.channels.forEach(function(t){return i.addChannel(r(t.getChild()))}),n.samplers.forEach(function(t){return i.addSampler(r(t.getChild()))}),this},r.addChannel=function(t){var n=this.graph.link("channel",this,t);return this.addGraphChild(this.channels,n)},r.removeChannel=function(t){return this.removeGraphChild(this.channels,t)},r.listChannels=function(){return this.channels.map(function(t){return t.getChild()})},r.addSampler=function(t){var n=this.graph.link("sampler",this,t);return this.addGraphChild(this.samplers,n)},r.removeSampler=function(t){return this.removeGraphChild(this.samplers,t)},r.listSamplers=function(){return this.samplers.map(function(t){return t.getChild()})},n}(R);o([v],O.prototype,"channels",void 0),o([v],O.prototype,"samplers",void 0);var U=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.ANIMATION_CHANNEL,n.U=null,n.targetNode=null,n.sampler=null,n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.U=n.U,n.targetNode&&this.setTargetNode(r(n.targetNode.getChild())),n.sampler&&this.setSampler(r(n.sampler.getChild())),this},r.getTargetPath=function(){return this.U},r.setTargetPath=function(t){return this.U=t,this},r.getTargetNode=function(){return this.targetNode?this.targetNode.getChild():null},r.setTargetNode=function(t){return this.targetNode=this.graph.link("target.node",this,t),this},r.getSampler=function(){return this.sampler?this.sampler.getChild():null},r.setSampler=function(t){return this.sampler=this.graph.link("sampler",this,t),this},n}(S);o([a],U.prototype,"targetNode",void 0),o([a],U.prototype,"sampler",void 0);var j=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.ANIMATION_SAMPLER,n.j="LINEAR",n.input=null,n.output=null,n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.j=n.j,n.input&&this.setInput(r(n.input.getChild())),n.output&&this.setOutput(r(n.output.getChild())),this},r.getInterpolation=function(){return this.j},r.setInterpolation=function(t){return this.j=t,this},r.getInput=function(){return this.input?this.input.getChild():null},r.setInput=function(t){return this.input=this.graph.link("input",this,t),this},r.getOutput=function(){return this.output?this.output.getChild():null},r.setOutput=function(t){return this.output=this.graph.link("output",this,t),this},n}(S);o([a],j.prototype,"input",void 0),o([a],j.prototype,"output",void 0);var _=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.BUFFER,n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this._=n._,this},r.getURI=function(){return this._},r.setURI=function(t){return this._=t,this},n}(R),k=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.CAMERA,n.S="perspective",n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.S=n.S,this.k=n.k,this.C=n.C,this.L=n.L,this.B=n.B,this.P=n.P,this.V=n.V,this},r.getType=function(){return this.S},r.setType=function(t){return this.S=t,this},r.getZNear=function(){return this.k},r.setZNear=function(t){return this.k=t,this},r.getZFar=function(){return this.C},r.setZFar=function(t){return this.C=t,this},r.getAspectRatio=function(){return this.L},r.setAspectRatio=function(t){return this.L=t,this},r.getYFov=function(){return this.B},r.setYFov=function(t){return this.B=t,this},r.getXMag=function(){return this.P},r.setXMag=function(t){return this.P=t,this},r.getYMag=function(){return this.V},r.setYMag=function(t){return this.V=t,this},n}(R),C=function(t){function n(n,r){var i;return(i=t.call(this,n)||this).D=r,i.D.addExtensionProperty(e(i)),i}i(n,t);var r=n.prototype;return r.dispose=function(){this.D.removeExtensionProperty(this),t.prototype.dispose.call(this)},r.T=function(t){if(!this.parentTypes.includes(t.propertyType))throw new Error('Parent "'+t.propertyType+'" invalid for child "'+this.propertyType+'".')},n}(S),L=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).semantic="",n}return i(n,t),n.prototype.copy=function(t){return this.semantic=t.semantic,this},n}(h),B=function(t){function n(){return t.apply(this,arguments)||this}return i(n,t),n.prototype.copy=function(t){return this},n}(h),P=function(t){function n(){return t.apply(this,arguments)||this}i(n,t);var r=n.prototype;return r.linkAttribute=function(t,n,r){if(!r)return null;var i=new L(t,n,r);return this.registerLink(i),i},r.linkIndex=function(t,n,r){if(!r)return null;var i=new B(t,n,r);return this.registerLink(i),i},n}(c),V=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.TEXTURE_INFO,n.G=0,n.F=null,n.J=null,n.q=10497,n.$=10497,n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.G=n.G,this.F=n.F,this.J=n.J,this.q=n.q,this.$=n.$,this},r.getTexCoord=function(){return this.G},r.setTexCoord=function(t){return this.G=t,this},r.getMagFilter=function(){return this.F},r.setMagFilter=function(t){return this.F=t,this},r.getMinFilter=function(){return this.J},r.setMinFilter=function(t){return this.J=t,this},r.getWrapS=function(){return this.q},r.setWrapS=function(t){return this.q=t,this},r.getWrapT=function(){return this.$},r.setWrapT=function(t){return this.$=t,this},n}(R);V.TextureWrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},V.TextureMagFilter={NEAREST:9728,LINEAR:9729},V.TextureMinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};var D=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.MATERIAL,n.Y="OPAQUE",n.H=.5,n.K=!1,n.W=[1,1,1,1],n.X=[0,0,0],n.Z=1,n.tt=1,n.nt=1,n.rt=1,n.baseColorTexture=null,n.baseColorTextureInfo=n.graph.link("baseColorTextureInfo",e(n),new V(n.graph)),n.emissiveTexture=null,n.emissiveTextureInfo=n.graph.link("emissiveTextureInfo",e(n),new V(n.graph)),n.normalTexture=null,n.normalTextureInfo=n.graph.link("normalTextureInfo",e(n),new V(n.graph)),n.occlusionTexture=null,n.occlusionTextureInfo=n.graph.link("occlusionTextureInfo",e(n),new V(n.graph)),n.metallicRoughnessTexture=null,n.metallicRoughnessTextureInfo=n.graph.link("metallicRoughnessTextureInfo",e(n),new V(n.graph)),n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.Y=n.Y,this.H=n.H,this.K=n.K,this.W=[].concat(n.W),this.X=[].concat(n.X),this.Z=n.Z,this.tt=n.tt,this.nt=n.nt,this.rt=n.rt,n.baseColorTexture&&(this.setBaseColorTexture(r(n.baseColorTexture.getChild())),this.getBaseColorTextureInfo().copy(r(n.baseColorTextureInfo.getChild()),r)),n.emissiveTexture&&(this.setEmissiveTexture(r(n.emissiveTexture.getChild())),this.getEmissiveTextureInfo().copy(r(n.emissiveTextureInfo.getChild()),r)),n.normalTexture&&(this.setNormalTexture(r(n.normalTexture.getChild())),this.getNormalTextureInfo().copy(r(n.normalTextureInfo.getChild()),r)),n.occlusionTexture&&(this.setOcclusionTexture(r(n.occlusionTexture.getChild())),this.getOcclusionTextureInfo().copy(r(n.occlusionTextureInfo.getChild()),r)),n.metallicRoughnessTexture&&(this.setMetallicRoughnessTexture(r(n.metallicRoughnessTexture.getChild())),this.getMetallicRoughnessTextureInfo().copy(r(n.metallicRoughnessTextureInfo.getChild()),r)),this},r.dispose=function(){this.baseColorTextureInfo.getChild().dispose(),this.emissiveTextureInfo.getChild().dispose(),this.normalTextureInfo.getChild().dispose(),this.occlusionTextureInfo.getChild().dispose(),this.metallicRoughnessTextureInfo.getChild().dispose(),t.prototype.dispose.call(this)},r.getDoubleSided=function(){return this.K},r.setDoubleSided=function(t){return this.K=t,this},r.getAlpha=function(){return this.W[3]},r.setAlpha=function(t){return this.W[3]=t,this},r.getAlphaMode=function(){return this.Y},r.setAlphaMode=function(t){return this.Y=t,this},r.getAlphaCutoff=function(){return this.H},r.setAlphaCutoff=function(t){return this.H=t,this},r.getBaseColorFactor=function(){return this.W},r.setBaseColorFactor=function(t){return this.W=t,this},r.getBaseColorHex=function(){return w.factorToHex(this.W)},r.setBaseColorHex=function(t){return w.hexToFactor(t,this.W),this},r.getBaseColorTexture=function(){return this.baseColorTexture?this.baseColorTexture.getChild():null},r.getBaseColorTextureInfo=function(){return this.baseColorTexture?this.baseColorTextureInfo.getChild():null},r.setBaseColorTexture=function(t){return this.baseColorTexture=this.graph.link("baseColorTexture",this,t),this},r.getEmissiveFactor=function(){return this.X},r.setEmissiveFactor=function(t){return this.X=t,this},r.getEmissiveHex=function(){return w.factorToHex(this.X)},r.setEmissiveHex=function(t){return w.hexToFactor(t,this.X),this},r.getEmissiveTexture=function(){return this.emissiveTexture?this.emissiveTexture.getChild():null},r.getEmissiveTextureInfo=function(){return this.emissiveTexture?this.emissiveTextureInfo.getChild():null},r.setEmissiveTexture=function(t){return this.emissiveTexture=this.graph.link("emissiveTexture",this,t),this},r.getNormalScale=function(){return this.Z},r.setNormalScale=function(t){return this.Z=t,this},r.getNormalTexture=function(){return this.normalTexture?this.normalTexture.getChild():null},r.getNormalTextureInfo=function(){return this.normalTexture?this.normalTextureInfo.getChild():null},r.setNormalTexture=function(t){return this.normalTexture=this.graph.link("normalTexture",this,t),this},r.getOcclusionStrength=function(){return this.tt},r.setOcclusionStrength=function(t){return this.tt=t,this},r.getOcclusionTexture=function(){return this.occlusionTexture?this.occlusionTexture.getChild():null},r.getOcclusionTextureInfo=function(){return this.occlusionTexture?this.occlusionTextureInfo.getChild():null},r.setOcclusionTexture=function(t){return this.occlusionTexture=this.graph.link("occlusionTexture",this,t),this},r.getRoughnessFactor=function(){return this.nt},r.setRoughnessFactor=function(t){return this.nt=t,this},r.getMetallicFactor=function(){return this.rt},r.setMetallicFactor=function(t){return this.rt=t,this},r.getMetallicRoughnessTexture=function(){return this.metallicRoughnessTexture?this.metallicRoughnessTexture.getChild():null},r.getMetallicRoughnessTextureInfo=function(){return this.metallicRoughnessTexture?this.metallicRoughnessTextureInfo.getChild():null},r.setMetallicRoughnessTexture=function(t){return this.metallicRoughnessTexture=this.graph.link("metallicRoughnessTexture",this,t),this},n}(R);o([a],D.prototype,"baseColorTexture",void 0),o([a],D.prototype,"baseColorTextureInfo",void 0),o([a],D.prototype,"emissiveTexture",void 0),o([a],D.prototype,"emissiveTextureInfo",void 0),o([a],D.prototype,"normalTexture",void 0),o([a],D.prototype,"normalTextureInfo",void 0),o([a],D.prototype,"occlusionTexture",void 0),o([a],D.prototype,"occlusionTextureInfo",void 0),o([a],D.prototype,"metallicRoughnessTexture",void 0),o([a],D.prototype,"metallicRoughnessTextureInfo",void 0);var G=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.MESH,n.it=[],n.primitives=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.it=[].concat(n.it),this.clearGraphChildList(this.primitives),n.primitives.forEach(function(t){return i.addPrimitive(r(t.getChild()))}),this},r.addPrimitive=function(t){return this.addGraphChild(this.primitives,this.graph.link("primitive",this,t))},r.removePrimitive=function(t){return this.removeGraphChild(this.primitives,t)},r.listPrimitives=function(){return this.primitives.map(function(t){return t.getChild()})},r.getWeights=function(){return this.it},r.setWeights=function(t){return this.it=t,this},n}(R);o([v],G.prototype,"primitives",void 0);var F=function(t){function r(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.NODE,n.et=[0,0,0],n.ut=[0,0,0,1],n.st=[1,1,1],n.it=[],n.i=null,n.camera=null,n.mesh=null,n.skin=null,n.children=[],n}i(r,t);var e=r.prototype;return e.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.et=[].concat(n.et),this.ut=[].concat(n.ut),this.st=[].concat(n.st),this.it=[].concat(n.it),n.camera&&this.setCamera(r(n.camera.getChild())),n.mesh&&this.setMesh(r(n.mesh.getChild())),n.skin&&this.setSkin(r(n.skin.getChild())),r!==M&&(this.clearGraphChildList(this.children),n.children.forEach(function(t){return i.addChild(r(t.getChild()))})),this},e.getTranslation=function(){return this.et},e.getRotation=function(){return this.ut},e.getScale=function(){return this.st},e.setTranslation=function(t){return this.et=t,this},e.setRotation=function(t){return this.ut=t,this},e.setScale=function(t){return this.st=t,this},e.getMatrix=function(){return n.fromRotationTranslationScale([],this.ut,this.et,this.st)},e.getWorldTranslation=function(){return n.getTranslation([],this.getWorldMatrix())},e.getWorldRotation=function(){return n.getRotation([],this.getWorldMatrix())},e.getWorldScale=function(){return n.getScaling([],this.getWorldMatrix())},e.getWorldMatrix=function(){for(var t,i=[],e=this;e instanceof r;e=e.i)i.push(e);for(var u=i.pop().getMatrix();t=i.pop();)n.multiply(u,u,t.getMatrix());return u},e.addChild=function(t){t.i&&t.i.removeChild(t);var n=this.graph.link("child",this,t);return this.addGraphChild(this.children,n),t.i=this,n.onDispose(function(){return t.i=null}),this},e.removeChild=function(t){return this.removeGraphChild(this.children,t)},e.listChildren=function(){return this.children.map(function(t){return t.getChild()})},e.getParent=function(){return this.i},e.getMesh=function(){return this.mesh?this.mesh.getChild():null},e.setMesh=function(t){return this.mesh=this.graph.link("mesh",this,t),this},e.getCamera=function(){return this.camera?this.camera.getChild():null},e.setCamera=function(t){return this.camera=this.graph.link("camera",this,t),this},e.getSkin=function(){return this.skin?this.skin.getChild():null},e.setSkin=function(t){return this.skin=this.graph.link("skin",this,t),this},e.getWeights=function(){return this.it},e.setWeights=function(t){return this.it=t,this},e.traverse=function(t){t(this);for(var n,r=s(this.listChildren());!(n=r()).done;)n.value.traverse(t);return this},r}(R);o([a],F.prototype,"camera",void 0),o([a],F.prototype,"mesh",void 0),o([a],F.prototype,"skin",void 0),o([v],F.prototype,"children",void 0);var J=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.PRIMITIVE,n.ot=4,n.material=null,n.indices=null,n.attributes=[],n.targets=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.ot=n.ot,n.indices&&this.setIndices(r(n.indices.getChild())),n.material&&this.setMaterial(r(n.material.getChild())),this.clearGraphChildList(this.attributes),n.listSemantics().forEach(function(t){i.setAttribute(t,r(n.getAttribute(t)))}),this.clearGraphChildList(this.targets),n.targets.forEach(function(t){return i.addTarget(r(t.getChild()))}),this},r.getIndices=function(){return this.indices?this.indices.getChild():null},r.setIndices=function(t){return this.indices=this.graph.linkIndex("index",this,t),this},r.getAttribute=function(t){var n=this.attributes.find(function(n){return n.semantic===t});return n?n.getChild():null},r.setAttribute=function(t,n){var r=this.getAttribute(t);if(r&&this.removeGraphChild(this.attributes,r),!n)return this;var i=this.graph.linkAttribute(t.toLowerCase(),this,n);return i.semantic=t,this.addGraphChild(this.attributes,i)},r.listAttributes=function(){return this.attributes.map(function(t){return t.getChild()})},r.listSemantics=function(){return this.attributes.map(function(t){return t.semantic})},r.getMaterial=function(){return this.material?this.material.getChild():null},r.setMaterial=function(t){return this.material=this.graph.link("material",this,t),this},r.getMode=function(){return this.ot},r.setMode=function(t){return this.ot=t,this},r.listTargets=function(){return this.targets.map(function(t){return t.getChild()})},r.addTarget=function(t){return this.addGraphChild(this.targets,this.graph.link("target",this,t)),this},r.removeTarget=function(t){return this.removeGraphChild(this.targets,t)},n}(S);o([a],J.prototype,"material",void 0),o([a],J.prototype,"indices",void 0),o([v],J.prototype,"attributes",void 0),o([v],J.prototype,"targets",void 0);var z=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.PRIMITIVE_TARGET,n.attributes=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.clearGraphChildList(this.attributes),n.listSemantics().forEach(function(t){i.setAttribute(t,r(n.getAttribute(t)))}),this},r.getAttribute=function(t){var n=this.attributes.find(function(n){return n.semantic===t});return n?n.getChild():null},r.setAttribute=function(t,n){var r=this.getAttribute(t);if(r&&this.removeGraphChild(this.attributes,r),!n)return this;var i=this.graph.linkAttribute(t.toLowerCase(),this,n);return i.semantic=t,this.addGraphChild(this.attributes,i)},r.listAttributes=function(){return this.attributes.map(function(t){return t.getChild()})},r.listSemantics=function(){return this.attributes.map(function(t){return t.semantic})},n}(S);o([v],z.prototype,"attributes",void 0);var q=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.ROOT,n.ht={generator:"glTF-Transform v0.7.4",version:"2.0"},n.ft=new Set,n.accessors=[],n.animations=[],n.buffers=[],n.cameras=[],n.materials=[],n.meshes=[],n.nodes=[],n.scenes=[],n.skins=[],n.textures=[],n}i(n,t);var r=n.prototype;return r.clone=function(){throw new Error("Root cannot be cloned.")},r.copy=function(n,r){var i=this;if(void 0===r&&(r=M),t.prototype.copy.call(this,n,r),!r)throw new Error("Root cannot be copied.");return Object.assign(this.ht,n.ht),n.accessors.forEach(function(t){return i.ct(r(t.getChild()))}),n.animations.forEach(function(t){return i.at(r(t.getChild()))}),n.buffers.forEach(function(t){return i.vt(r(t.getChild()))}),n.cameras.forEach(function(t){return i.lt(r(t.getChild()))}),n.materials.forEach(function(t){return i.dt(r(t.getChild()))}),n.meshes.forEach(function(t){return i.wt(r(t.getChild()))}),n.nodes.forEach(function(t){return i.pt(r(t.getChild()))}),n.scenes.forEach(function(t){return i.xt(r(t.getChild()))}),n.skins.forEach(function(t){return i.yt(r(t.getChild()))}),n.textures.forEach(function(t){return i.bt(r(t.getChild()))}),this},r.getAsset=function(){return this.ht},r.listExtensionsUsed=function(){return Array.from(this.ft)},r.listExtensionsRequired=function(){return this.listExtensionsUsed().filter(function(t){return t.isRequired()})},r.At=function(t){if(this.ft.has(t))throw new Error('Extension "'+t.extensionName+'" is already enabled.');return this.ft.add(t),this},r.Et=function(t){return this.ft.delete(t),this},r.xt=function(t){return this.addGraphChild(this.scenes,this.graph.link("scene",this,t))},r.listScenes=function(){return this.scenes.map(function(t){return t.getChild()})},r.pt=function(t){return this.addGraphChild(this.nodes,this.graph.link("node",this,t))},r.listNodes=function(){return this.nodes.map(function(t){return t.getChild()})},r.lt=function(t){return this.addGraphChild(this.cameras,this.graph.link("camera",this,t))},r.listCameras=function(){return this.cameras.map(function(t){return t.getChild()})},r.yt=function(t){return this.addGraphChild(this.skins,this.graph.link("skin",this,t))},r.listSkins=function(){return this.skins.map(function(t){return t.getChild()})},r.wt=function(t){return this.addGraphChild(this.meshes,this.graph.link("mesh",this,t))},r.listMeshes=function(){return this.meshes.map(function(t){return t.getChild()})},r.dt=function(t){return this.addGraphChild(this.materials,this.graph.link("material",this,t))},r.listMaterials=function(){return this.materials.map(function(t){return t.getChild()})},r.bt=function(t){return this.addGraphChild(this.textures,this.graph.link("texture",this,t))},r.listTextures=function(){return this.textures.map(function(t){return t.getChild()})},r.at=function(t){return this.addGraphChild(this.animations,this.graph.link("animation",this,t))},r.listAnimations=function(){return this.animations.map(function(t){return t.getChild()})},r.ct=function(t){return this.addGraphChild(this.accessors,this.graph.link("accessor",this,t))},r.listAccessors=function(){return this.accessors.map(function(t){return t.getChild()})},r.vt=function(t){return this.addGraphChild(this.buffers,this.graph.link("buffer",this,t))},r.listBuffers=function(){return this.buffers.map(function(t){return t.getChild()})},n}(S);o([v],q.prototype,"accessors",void 0),o([v],q.prototype,"animations",void 0),o([v],q.prototype,"buffers",void 0),o([v],q.prototype,"cameras",void 0),o([v],q.prototype,"materials",void 0),o([v],q.prototype,"meshes",void 0),o([v],q.prototype,"nodes",void 0),o([v],q.prototype,"scenes",void 0),o([v],q.prototype,"skins",void 0),o([v],q.prototype,"textures",void 0);var $=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.SCENE,n.children=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),r!==M&&(this.clearGraphChildList(this.children),n.children.forEach(function(t){return i.addChild(r(t.getChild()))})),this},r.addChild=function(t){t.i&&t.i.removeChild(t);var n=this.graph.link("child",this,t);return this.addGraphChild(this.children,n),t.i=this,n.onDispose(function(){return t.i=null}),this},r.removeChild=function(t){return this.removeGraphChild(this.children,t)},r.listChildren=function(){return this.children.map(function(t){return t.getChild()})},r.traverse=function(t){for(var n,r=s(this.listChildren());!(n=r()).done;)n.value.traverse(t);return this},n}(R);o([v],$.prototype,"children",void 0);var Y=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.SKIN,n.skeleton=null,n.inverseBindMatrices=null,n.joints=[],n}i(n,t);var r=n.prototype;return r.copy=function(n,r){var i=this;return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),n.skeleton&&this.setSkeleton(r(n.skeleton.getChild())),n.inverseBindMatrices&&this.setInverseBindMatrices(r(n.inverseBindMatrices.getChild())),this.clearGraphChildList(this.joints),n.joints.forEach(function(t){return i.addJoint(r(t.getChild()))}),this},r.getSkeleton=function(){return this.skeleton?this.skeleton.getChild():null},r.setSkeleton=function(t){return this.skeleton=this.graph.link("skeleton",this,t),this},r.getInverseBindMatrices=function(){return this.inverseBindMatrices?this.inverseBindMatrices.getChild():null},r.setInverseBindMatrices=function(t){return this.inverseBindMatrices=this.graph.link("inverseBindMatrices",this,t),this},r.addJoint=function(t){var n=this.graph.link("joint",this,t);return this.addGraphChild(this.joints,n)},r.removeJoint=function(t){return this.removeGraphChild(this.joints,t)},r.listJoints=function(){return this.joints.map(function(t){return t.getChild()})},n}(R);o([a],Y.prototype,"skeleton",void 0),o([a],Y.prototype,"inverseBindMatrices",void 0),o([v],Y.prototype,"joints",void 0);var H=function(t){function n(){var n;return(n=t.apply(this,arguments)||this).propertyType=exports.PropertyType.TEXTURE,n.gt=null,n.Tt="",n._="",n}i(n,t);var r=n.prototype;return r.copy=function(n,r){return void 0===r&&(r=M),t.prototype.copy.call(this,n,r),this.Tt=n.Tt,this._=n._,n.gt&&(this.gt=n.gt.slice(0)),this},r.getMimeType=function(){return this.Tt},r.setMimeType=function(t){return this.Tt=t,this},r.getURI=function(){return this._},r.setURI=function(t){return this._=t,this},r.getImage=function(){return this.gt},r.setImage=function(t){return this.gt=t,this},r.getSize=function(){return(this.Tt?"image/png"===this.Tt:this._.match(/\.png$/))?x.getSizePNG(this.gt):x.getSizeJPEG(this.gt)},n}(R),K="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator";function Q(t,n,r){if(!t.s){if(r instanceof W){if(!r.s)return void(r.o=Q.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(Q.bind(null,t,n),Q.bind(null,t,2));t.s=n,t.v=r;var i=t.o;i&&i(t)}}var W=function(){function t(){}return t.prototype.then=function(n,r){var i=new t,e=this.s;if(e){var u=1&e?n:r;if(u){try{Q(i,1,u(this.v))}catch(t){Q(i,2,t)}return i}return this}return this.o=function(t){try{var e=t.v;1&t.s?Q(i,1,n?n(e):e):r?Q(i,1,r(e)):Q(i,2,e)}catch(t){Q(i,2,t)}},i},t}();function X(t){return t instanceof W&&1&t.s}function Z(t,n,r){if("function"==typeof t[K]){var i,e,u,s=t[K]();if(function t(o){try{for(;!((i=s.next()).done||r&&r());)if((o=n(i.value))&&o.then){if(!X(o))return void o.then(t,u||(u=Q.bind(null,e=new W,2)));o=o.v}e?Q(e,1,o):e=o}catch(t){Q(e||(e=new W),2,t)}}(),s.return){var o=function(t){try{i.done||s.return()}catch(t){}return t};if(e&&e.then)return e.then(o,function(t){throw o(t)});o()}return e}if(!("length"in t))throw new TypeError("Object is not iterable");for(var h=[],f=0;f<t.length;f++)h.push(t[f]);return function(t,n,r){var i,e,u=-1;return function s(o){try{for(;++u<t.length&&(!r||!r());)if((o=n(u))&&o.then){if(!X(o))return void o.then(s,e||(e=Q.bind(null,i=new W,2)));o=o.v}i?Q(i,1,o):i=o}catch(t){Q(i||(i=new W),2,t)}}(),i}(h,function(t){return n(h[t])},r)}var tt=function(){function t(){this.Mt=new P,this.St=new q(this.Mt),this.It=A.DEFAULT_INSTANCE}var n=t.prototype;return n.getRoot=function(){return this.St},n.getGraph=function(){return this.Mt},n.getLogger=function(){return this.It},n.setLogger=function(t){return this.It=t,this},n.clone=function(){return(new t).merge(this)},n.merge=function(t){for(var n,r={},i=s(t.getRoot().listExtensionsUsed());!(n=i()).done;){var e=n.value,u=this.createExtension(e.constructor);e.isRequired()&&u.setRequired(!0),r[u.extensionName]=u}var o=new Set,h=new Map;o.add(t.St),h.set(t.St,this.St);for(var f,c=s(t.Mt.getLinks());!(f=c()).done;)for(var a=f.value,v=0,l=[a.getParent(),a.getChild()];v<l.length;v++){var d=l[v];if(!o.has(d)){var w=void 0;if(d.propertyType===exports.PropertyType.TEXTURE_INFO)w=d;else{var p=d.constructor;w=d instanceof C?new p(this.Mt,r[d.extensionName]):new p(this.Mt)}h.set(d,w),o.add(d)}}for(var x,y=function(t){return h.get(t)},b=s(o);!(x=b()).done;){var A=x.value;h.get(A).copy(A,y)}return this},n.transform=function(){try{var t=arguments,n=this,r=Z([].slice.call(t),function(t){return Promise.resolve(t(n)).then(function(){})});return Promise.resolve(r&&r.then?r.then(function(){return n}):n)}catch(t){return Promise.reject(t)}},n.createExtension=function(t){return this.getRoot().listExtensionsUsed().find(function(n){return n.extensionName===t.EXTENSION_NAME})||new t(this)},n.createScene=function(t){void 0===t&&(t="");var n=new $(this.Mt,t);return this.St.xt(n),n},n.createNode=function(t){void 0===t&&(t="");var n=new F(this.Mt,t);return this.St.pt(n),n},n.createCamera=function(t){void 0===t&&(t="");var n=new k(this.Mt,t);return this.St.lt(n),n},n.createSkin=function(t){void 0===t&&(t="");var n=new Y(this.Mt,t);return this.St.yt(n),n},n.createMesh=function(t){void 0===t&&(t="");var n=new G(this.Mt,t);return this.St.wt(n),n},n.createPrimitive=function(){return new J(this.Mt)},n.createPrimitiveTarget=function(t){return void 0===t&&(t=""),new z(this.Mt,t)},n.createMaterial=function(t){void 0===t&&(t="");var n=new D(this.Mt,t);return this.St.dt(n),n},n.createTexture=function(t){void 0===t&&(t="");var n=new H(this.Mt,t);return this.St.bt(n),n},n.createAnimation=function(t){void 0===t&&(t="");var n=new O(this.Mt,t);return this.St.at(n),n},n.createAnimationChannel=function(t){return void 0===t&&(t=""),new U(this.Mt,t)},n.createAnimationSampler=function(t){return void 0===t&&(t=""),new j(this.Mt,t)},n.createAccessor=function(t,n){void 0===t&&(t=""),void 0===n&&(n=null),n||(n=this.getRoot().listBuffers()[0]);var r=new N(this.Mt,t).setBuffer(n);return this.St.ct(r),r},n.createBuffer=function(t){void 0===t&&(t="");var n=new _(this.Mt,t);return this.St.vt(n),n},t}(),nt=function(){function t(t){this.doc=t,this.provideTypes=[],this.dependencies=[],this.required=!1,this.properties=new Set,t.getRoot().At(this)}var n=t.prototype;return n.dispose=function(){this.doc.getRoot().Et(this);for(var t,n=s(this.properties);!(t=n()).done;)t.value.dispose()},n.isRequired=function(){return this.required},n.setRequired=function(t){return this.required=t,this},n.addExtensionProperty=function(t){return this.properties.add(t),this},n.removeExtensionProperty=function(t){return this.properties.delete(t),this},n.install=function(t,n){return this},n.provide=function(t,n){return this},t}(),rt=function(){function t(t){this.jsonDoc=t,this.buffers=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[]}return t.prototype.setTextureInfo=function(t,n){this.textureInfos.set(t,n),void 0!==n.texCoord&&t.setTexCoord(n.texCoord);var r=this.jsonDoc.json.textures[n.index];if(void 0!==r.sampler){var i=this.jsonDoc.json.samplers[r.sampler];void 0!==i.magFilter&&t.setMagFilter(i.magFilter),void 0!==i.minFilter&&t.setMinFilter(i.minFilter),void 0!==i.wrapS&&t.setWrapS(i.wrapS),void 0!==i.wrapT&&t.setWrapT(i.wrapT)}},t}(),it={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},et={logger:A.DEFAULT_INSTANCE,extensions:[],dependencies:{}},ut=function(){function t(){}return t.read=function(t,i){void 0===i&&(i=et);var e=t.json,u=new tt;this.validate(t,i);var o=new rt(t),h=t.json.asset,f=u.getRoot().getAsset();h.copyright&&(f.copyright=h.copyright),h.extras&&(f.extras=h.extras),h.generator&&(f.generator=h.generator),h.minVersion&&(f.minVersion=h.minVersion);for(var c,a=e.extensionsUsed||[],v=e.extensionsRequired||[],l=s(i.extensions);!(c=l()).done;){var d=c.value;if(a.includes(d.EXTENSION_NAME))for(var w,y=u.createExtension(d).setRequired(v.includes(d.EXTENSION_NAME)),b=s(y.dependencies);!(w=b()).done;){var A=w.value;y.install(A,i.dependencies[A])}}o.buffers=(e.buffers||[]).map(function(t){var n=u.createBuffer(t.name);return t.extras&&n.setExtras(t.extras),t.uri&&0!==t.uri.indexOf("__")&&n.setURI(t.uri),n}),o.bufferViewBuffers=(e.bufferViews||[]).map(function(t){return o.buffers[t.buffer]}),o.accessors=(e.accessors||[]).map(function(n){var i,e=u.createAccessor(n.name,o.bufferViewBuffers[n.bufferView]).setType(n.type);return n.extras&&e.setExtras(n.extras),void 0!==n.normalized&&e.setNormalized(n.normalized),void 0!==n.bufferView||n.sparse?(i=void 0!==n.sparse?function(t,n){var i,e=it[t.componentType],u=N.getElementSize(t.type);i=void 0!==t.bufferView?st(t,n).slice():new e(t.count*u);for(var s=t.sparse.count,o=r(r(r({},t),t.sparse.indices),{},{count:s,type:"SCALAR"}),h=r(r(r({},t),t.sparse.values),{},{count:s}),f=st(o,n),c=st(h,n),a=0;a<o.count;a++)for(var v=0;v<u;v++)i[f[a]*u+v]=c[a*u+v];return i}(n,t):st(n,t).slice(),e.setArray(i),e):e});var m=e.images||[],E=e.textures||[];u.getRoot().listExtensionsUsed().filter(function(t){return t.provideTypes.includes(exports.PropertyType.TEXTURE)}).forEach(function(t){return t.provide(o,exports.PropertyType.TEXTURE)}),o.textures=m.map(function(n){var r=u.createTexture(n.name);if(n.extras&&r.setExtras(n.extras),void 0!==n.bufferView){var i=e.bufferViews[n.bufferView],s=t.json.buffers[i.buffer],o=i.byteOffset||0,h=(s.uri?t.resources[s.uri]:t.resources["@glb.bin"]).slice(o,o+i.byteLength);r.setImage(h)}else void 0!==n.uri&&(r.setImage(t.resources[n.uri]),0!==n.uri.indexOf("__")&&r.setURI(n.uri));if(void 0!==n.mimeType)r.setMimeType(n.mimeType);else if(n.uri){var f=p.extension(n.uri);r.setMimeType(x.extensionToMimeType(f))}return r}),o.materials=(e.materials||[]).map(function(t){var n=u.createMaterial(t.name);t.extras&&n.setExtras(t.extras),void 0!==t.alphaMode&&n.setAlphaMode(t.alphaMode),void 0!==t.alphaCutoff&&n.setAlphaCutoff(t.alphaCutoff),void 0!==t.doubleSided&&n.setDoubleSided(t.doubleSided);var r=t.pbrMetallicRoughness||{};if(void 0!==r.baseColorFactor&&n.setBaseColorFactor(r.baseColorFactor),void 0!==t.emissiveFactor&&n.setEmissiveFactor(t.emissiveFactor),void 0!==r.metallicFactor&&n.setMetallicFactor(r.metallicFactor),void 0!==r.roughnessFactor&&n.setRoughnessFactor(r.roughnessFactor),void 0!==r.baseColorTexture){var i=r.baseColorTexture;n.setBaseColorTexture(o.textures[E[i.index].source]),o.setTextureInfo(n.getBaseColorTextureInfo(),i)}if(void 0!==t.emissiveTexture){var e=t.emissiveTexture;n.setEmissiveTexture(o.textures[E[e.index].source]),o.setTextureInfo(n.getEmissiveTextureInfo(),e)}if(void 0!==t.normalTexture){var s=t.normalTexture;n.setNormalTexture(o.textures[E[s.index].source]),o.setTextureInfo(n.getNormalTextureInfo(),s),void 0!==t.normalTexture.scale&&n.setNormalScale(t.normalTexture.scale)}if(void 0!==t.occlusionTexture){var h=t.occlusionTexture;n.setOcclusionTexture(o.textures[E[h.index].source]),o.setTextureInfo(n.getOcclusionTextureInfo(),h),void 0!==t.occlusionTexture.strength&&n.setOcclusionStrength(t.occlusionTexture.strength)}if(void 0!==r.metallicRoughnessTexture){var f=r.metallicRoughnessTexture;n.setMetallicRoughnessTexture(o.textures[E[f.index].source]),o.setTextureInfo(n.getMetallicRoughnessTextureInfo(),f)}return n});var g=e.meshes||[];u.getRoot().listExtensionsUsed().filter(function(t){return t.provideTypes.includes(exports.PropertyType.PRIMITIVE)}).forEach(function(t){return t.provide(o,exports.PropertyType.PRIMITIVE)}),o.meshes=g.map(function(t){var n=u.createMesh(t.name);return t.extras&&n.setExtras(t.extras),void 0!==t.weights&&n.setWeights(t.weights),t.primitives.forEach(function(r){var i=u.createPrimitive();r.extras&&i.setExtras(r.extras),void 0!==r.material&&i.setMaterial(o.materials[r.material]),void 0!==r.mode&&i.setMode(r.mode);for(var e=0,s=Object.entries(r.attributes||{});e<s.length;e++){var h=s[e];i.setAttribute(h[0],o.accessors[h[1]])}void 0!==r.indices&&i.setIndices(o.accessors[r.indices]);var f=t.extras&&t.extras.targetNames||[];(r.targets||[]).forEach(function(t,n){for(var r=f[n]||n.toString(),e=u.createPrimitiveTarget(r),s=0,h=Object.entries(t);s<h.length;s++){var c=h[s];e.setAttribute(c[0],o.accessors[c[1]])}i.addTarget(e)}),n.addPrimitive(i)}),n}),o.cameras=(e.cameras||[]).map(function(t){var n=u.createCamera(t.name).setType(t.type);return t.extras&&n.setExtras(t.extras),"perspective"===t.type?n.setZNear(t.perspective.znear).setZFar(t.perspective.zfar).setYFov(t.perspective.yfov).setAspectRatio(t.perspective.aspectRatio):n.setZNear(t.orthographic.znear).setZFar(t.orthographic.zfar).setXMag(t.orthographic.xmag).setYMag(t.orthographic.ymag),n});var T=e.nodes||[];return o.nodes=T.map(function(t){var r=u.createNode(t.name);return t.extras&&r.setExtras(t.extras),void 0!==t.translation&&r.setTranslation(t.translation),void 0!==t.rotation&&r.setRotation(t.rotation),void 0!==t.scale&&r.setScale(t.scale),void 0!==t.matrix&&(r.setTranslation(n.getTranslation([],t.matrix)),r.setRotation(n.getRotation([],t.matrix)),r.setScale(n.getScaling([],t.matrix))),void 0!==t.weights&&r.setWeights(t.weights),r}),o.skins=(e.skins||[]).map(function(t){var n=u.createSkin(t.name);t.extras&&n.setExtras(t.extras),void 0!==t.inverseBindMatrices&&n.setInverseBindMatrices(o.accessors[t.inverseBindMatrices]),void 0!==t.skeleton&&n.setSkeleton(o.nodes[t.skeleton]);for(var r,i=s(t.joints);!(r=i()).done;)n.addJoint(o.nodes[r.value]);return n}),T.map(function(t,n){var r=o.nodes[n];(t.children||[]).forEach(function(t){return r.addChild(o.nodes[t])}),void 0!==t.mesh&&r.setMesh(o.meshes[t.mesh]),void 0!==t.camera&&r.setCamera(o.cameras[t.camera]),void 0!==t.skin&&r.setSkin(o.skins[t.skin])}),o.animations=(e.animations||[]).map(function(t){var n=u.createAnimation(t.name);t.extras&&n.setExtras(t.extras);var r=(t.samplers||[]).map(function(t){var r=u.createAnimationSampler().setInput(o.accessors[t.input]).setOutput(o.accessors[t.output]).setInterpolation(t.interpolation||"LINEAR");return t.extras&&r.setExtras(t.extras),n.addSampler(r),r});return(t.channels||[]).forEach(function(t){var i=u.createAnimationChannel().setSampler(r[t.sampler]).setTargetNode(o.nodes[t.target.node]).setTargetPath(t.target.path);t.extras&&i.setExtras(t.extras),n.addChannel(i)}),n}),o.scenes=(e.scenes||[]).map(function(t){var n=u.createScene(t.name);return t.extras&&n.setExtras(t.extras),(t.nodes||[]).map(function(t){return o.nodes[t]}).forEach(function(t){return n.addChild(t)}),n}),u.getRoot().listExtensionsUsed().forEach(function(t){return t.read(o)}),u},t.validate=function(t,n){var r=t.json;if("2.0"!==r.asset.version)throw new Error('Unsupported glTF version, "'+r.asset.version+'".');if(r.extensionsRequired)for(var i,e=function(){var t=i.value;if(!n.extensions.find(function(n){return n.EXTENSION_NAME===t}))throw new Error('Missing required extension, "'+t+'".')},u=s(r.extensionsRequired);!(i=u()).done;)e();if(r.extensionsUsed)for(var o,h=function(){var t=o.value;n.extensions.find(function(n){return n.EXTENSION_NAME===t})||n.logger.warn('Missing optional extension, "'+t+'".')},f=s(r.extensionsUsed);!(o=f()).done;)h()},t}();function st(t,n){var r=n.json.bufferViews[t.bufferView],i=n.json.buffers[r.buffer],e=i.uri?n.resources[i.uri]:n.resources["@glb.bin"],u=it[t.componentType],s=N.getElementSize(t.type);if(void 0!==r.byteStride&&r.byteStride!==s*u.BYTES_PER_ELEMENT)return function(t,n){for(var r=n.json.bufferViews[t.bufferView],i=n.json.buffers[r.buffer],e=i.uri?n.resources[i.uri]:n.resources["@glb.bin"],u=it[t.componentType],s=N.getElementSize(t.type),o=u.BYTES_PER_ELEMENT,h=t.byteOffset||0,f=new u(t.count*s),c=new DataView(e,r.byteOffset,r.byteLength),a=r.byteStride,v=0;v<t.count;v++)for(var l=0;l<s;l++){var d=h+v*a+l*o,w=void 0;switch(t.componentType){case 5126:w=c.getFloat32(d,!0);break;case 5125:w=c.getUint32(d,!0);break;case 5123:w=c.getUint16(d,!0);break;case 5121:w=c.getUint8(d);break;case 5122:w=c.getInt16(d,!0);break;case 5120:w=c.getInt8(d);break;default:throw new Error('Unexpected componentType "'+t.componentType+'".')}f[v*s+l]=w}return f}(t,n);var o=(r.byteOffset||0)+(t.byteOffset||0);switch(t.componentType){case 5126:return new Float32Array(e,o,t.count*s);case 5125:return new Uint32Array(e,o,t.count*s);case 5123:return new Uint16Array(e,o,t.count*s);case 5121:return new Uint8Array(e,o,t.count*s);case 5122:return new Int16Array(e,o,t.count*s);case 5120:return new Int8Array(e,o,t.count*s);default:throw new Error('Unexpected componentType "'+t.componentType+'".')}}var ot=function(){function t(t,n){this.jsonDoc=t,this.options=n,this.accessorIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.imageData=[]}var n=t.prototype;return n.createTextureInfoDef=function(t,n){var r={magFilter:n.getMagFilter()||void 0,minFilter:n.getMinFilter()||void 0,wrapS:n.getWrapS(),wrapT:n.getWrapT()},i=JSON.stringify(r);this.samplerDefIndexMap.has(i)||(this.samplerDefIndexMap.set(i,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(r));var e={source:this.imageIndexMap.get(t),sampler:this.samplerDefIndexMap.get(i)},u=JSON.stringify(e);this.textureDefIndexMap.has(u)||(this.textureDefIndexMap.set(u,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(e));var s={index:this.textureDefIndexMap.get(u),texCoord:n.getTexCoord()};return this.textureInfoDefMap.set(n,s),s},n.createPropertyDef=function(t){var n={};return t.getName()&&(n.name=t.getName()),Object.keys(t.getExtras()).length>0&&(n.extras=t.getExtras()),n},n.createAccessorDef=function(t){var n=this.createPropertyDef(t);return n.type=t.getType(),n.componentType=t.getComponentType(),n.count=t.getCount(),t.getMax(n.max=[]),t.getMin(n.min=[]),n.normalized=t.getNormalized(),n},n.createImageData=function(t,n,r){if(this.options.isGLB)this.imageData.push(n),t.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:n.byteLength});else{var i=x.mimeTypeToExtension(r.getMimeType());t.uri=this.imageURIGenerator.createURI(r,i),this.jsonDoc.resources[t.uri]=n}},t}(),ht=function(){function t(t,n){this.multiple=t,this.basename=n,this.counter=1}return t.prototype.createURI=function(t,n){return t.getURI()?t.getURI():this.multiple?this.basename+"_"+this.counter+++"."+n:this.basename+"."+n},t}(),ft={logger:A.DEFAULT_INSTANCE,basename:"",isGLB:!0},ct=function(){function t(){}return t.write=function(t,n){void 0===n&&(n=ft);var r=t.getRoot(),i={json:{asset:r.getAsset()},resources:{}},e=n.logger||A.DEFAULT_INSTANCE,u=i.json;u.asset.generator="glTF-Transform v0.7.4";var o=new ot(i,n),h=r.listBuffers().length,f=r.listTextures().length;function c(t,n,r,i){for(var e,h=[],f=0,c=s(t);!(e=c()).done;){var a=e.value,v=o.createAccessorDef(a);v.bufferView=u.bufferViews.length;var l=d.pad(a.getArray().buffer);v.byteOffset=f,f+=l.byteLength,h.push(l),o.accessorIndexMap.set(a,u.accessors.length),u.accessors.push(v)}var w={buffer:n,byteOffset:r,byteLength:d.concat(h).byteLength};return i&&(w.target=i),u.bufferViews.push(w),{buffers:h,byteLength:f}}function a(t,n,r){for(var i,e=t[0].getCount(),h=0,f=s(t);!(i=f()).done;){var c=i.value,a=o.createAccessorDef(c);a.bufferView=u.bufferViews.length,a.byteOffset=h;var v=c.getElementSize(),l=c.getComponentSize();h+=d.padNumber(v*l),o.accessorIndexMap.set(c,u.accessors.length),u.accessors.push(a)}for(var w=e*h,p=new ArrayBuffer(w),x=new DataView(p),y=0;y<e;y++)for(var b,A=0,m=s(t);!(b=m()).done;){for(var E=b.value,g=E.getElementSize(),T=E.getComponentSize(),M=E.getComponentType(),S=E.getArray(),I=0;I<g;I++){var R=y*h+A+I*T,N=S[y*g+I];switch(M){case 5126:x.setFloat32(R,N,!0);break;case 5120:x.setInt8(R,N);break;case 5122:x.setInt16(R,N,!0);break;case 5121:x.setUint8(R,N);break;case 5123:x.setUint16(R,N,!0);break;case 5125:x.setUint32(R,N,!0);break;default:throw new Error("Unexpected component type: "+M)}}A+=d.padNumber(g*T)}return u.bufferViews.push({buffer:n,byteOffset:r,byteLength:w,byteStride:h,target:34962}),{byteLength:w,buffers:[p]}}o.bufferURIGenerator=new ht(h>1,n.basename),o.imageURIGenerator=new ht(f>1,n.basename),o.logger=t.getLogger();for(var v,l=new Map,w=s(t.getGraph().getLinks());!(v=w()).done;){var p=v.value;if(p.getParent()!==r){var x=p.getChild();if(x instanceof N){var y=l.get(x)||[];y.push(p),l.set(x,y)}}}return u.accessors=[],u.bufferViews=[],u.samplers=[],u.textures=[],u.images=r.listTextures().map(function(t,n){var r=o.createPropertyDef(t);return t.getMimeType()&&(r.mimeType=t.getMimeType()),t.getImage()&&o.createImageData(r,t.getImage(),t),o.imageIndexMap.set(t,n),r}),u.buffers=[],r.listBuffers().forEach(function(t){for(var r,e=o.createPropertyDef(t),h=new Map,f=new Set,v=new Set,w=new Set,p=s(t.listParents().filter(function(t){return!(t instanceof q)}));!(r=p()).done;){var x=r.value;if(!(x instanceof N))throw new Error("Unimplemented buffer reference: "+x);for(var y,b=!1,A=!1,m=!1,E=!1,g=l.get(x)||[],T=s(g);!(y=T()).done;){var M=y.value;M instanceof L?b=!0:M instanceof B?A=!0:"inverseBindMatrices"===M.getName()?m=!0:E=!0}if(b||A||m||E||(E=!0),!b||A||m||E)if(!A||b||m||E)if(!m||b||A||E){if(!E||b||A||m)throw new Error("Attribute, index, or IBM accessors must be used only for that purpose.");w.add(x)}else v.add(x);else f.add(x);else{var S=g[0].getParent(),I=h.get(S)||new Set;I.add(x),h.set(S,I)}}var R,O=[],U=u.buffers.length,j=0;if(f.size){var _=c(Array.from(f),U,j,34963);j+=_.byteLength,O.push.apply(O,_.buffers)}for(var k=0,C=Array.from(h.values());k<C.length;k++){var P=C[k];if(P.size){var V=a(Array.from(P),U,j);j+=V.byteLength,O.push.apply(O,V.buffers)}}if(v.size){var D=c(Array.from(v),U,j);j+=D.byteLength,O.push.apply(O,D.buffers)}if(w.size){var G=c(Array.from(w),U,j);j+=G.byteLength,O.push.apply(O,G.buffers)}if(o.imageData.length)for(var F=0;F<o.imageData.length;F++)u.bufferViews[u.images[F].bufferView].byteOffset=j,j+=o.imageData[F].byteLength,O.push(o.imageData[F]);j?(n.isGLB?R="@glb.bin":(R=o.bufferURIGenerator.createURI(t,"bin"),e.uri=R),e.byteLength=j,i.resources[R]=d.concat(O),u.buffers.push(e)):o.logger.warn('@gltf-transform/core: Skipping empty buffer, "'+t.getName()+'".')}),r.listAccessors().find(function(t){return!t.getBuffer()})&&e.warn("Skipped writing one or more Accessors: no Buffer assigned."),u.materials=r.listMaterials().map(function(t,n){var r=o.createPropertyDef(t);if(r.alphaMode=t.getAlphaMode(),"MASK"===t.getAlphaMode()&&(r.alphaCutoff=t.getAlphaCutoff()),r.doubleSided=t.getDoubleSided(),r.pbrMetallicRoughness={},r.pbrMetallicRoughness.baseColorFactor=t.getBaseColorFactor(),r.emissiveFactor=t.getEmissiveFactor(),r.pbrMetallicRoughness.roughnessFactor=t.getRoughnessFactor(),r.pbrMetallicRoughness.metallicFactor=t.getMetallicFactor(),t.getBaseColorTexture()){var i=t.getBaseColorTexture(),e=t.getBaseColorTextureInfo();r.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(i,e)}if(t.getEmissiveTexture()){var u=t.getEmissiveTexture(),s=t.getEmissiveTextureInfo();r.emissiveTexture=o.createTextureInfoDef(u,s)}if(t.getNormalTexture()){var h=t.getNormalTexture(),f=t.getNormalTextureInfo(),c=o.createTextureInfoDef(h,f);1!==t.getNormalScale()&&(c.scale=t.getNormalScale()),r.normalTexture=c}if(t.getOcclusionTexture()){var a=t.getOcclusionTexture(),v=t.getOcclusionTextureInfo(),l=o.createTextureInfoDef(a,v);1!==t.getOcclusionStrength()&&(l.strength=t.getOcclusionStrength()),r.occlusionTexture=l}if(t.getMetallicRoughnessTexture()){var d=t.getMetallicRoughnessTexture(),w=t.getMetallicRoughnessTextureInfo();r.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(d,w)}return o.materialIndexMap.set(t,n),r}),u.meshes=r.listMeshes().map(function(t,n){var r,i=o.createPropertyDef(t);return i.primitives=t.listPrimitives().map(function(t){var n={attributes:{}};n.material=o.materialIndexMap.get(t.getMaterial()),n.mode=t.getMode(),Object.keys(t.getExtras()).length&&(n.extras=t.getExtras()),t.getIndices()&&(n.indices=o.accessorIndexMap.get(t.getIndices()));for(var i,e=s(t.listSemantics());!(i=e()).done;){var u=i.value;n.attributes[u]=o.accessorIndexMap.get(t.getAttribute(u))}for(var h,f=s(t.listTargets());!(h=f()).done;){for(var c,a=h.value,v={},l=s(a.listSemantics());!(c=l()).done;){var d=c.value;v[d]=o.accessorIndexMap.get(a.getAttribute(d))}n.targets=n.targets||[],n.targets.push(v)}return t.listTargets().length&&!r&&(r=t.listTargets().map(function(t){return t.getName()})),n}),t.getWeights().length&&(i.weights=t.getWeights()),r&&(i.extras=i.extras||{},i.extras.targetNames=r),o.meshIndexMap.set(t,n),i}),u.cameras=r.listCameras().map(function(t,n){var r=o.createPropertyDef(t);return r.type=t.getType(),"perspective"===r.type?r.perspective={znear:t.getZNear(),zfar:t.getZFar(),yfov:t.getYFov(),aspectRatio:t.getAspectRatio()}:r.orthographic={znear:t.getZNear(),zfar:t.getZFar(),xmag:t.getXMag(),ymag:t.getYMag()},o.cameraIndexMap.set(t,n),r}),u.nodes=r.listNodes().map(function(t,n){var r=o.createPropertyDef(t);return r.translation=t.getTranslation(),r.rotation=t.getRotation(),r.scale=t.getScale(),t.getWeights().length&&(r.weights=t.getWeights()),o.nodeIndexMap.set(t,n),r}),u.skins=r.listSkins().map(function(t,n){var r=o.createPropertyDef(t);return t.getInverseBindMatrices()&&(r.inverseBindMatrices=o.accessorIndexMap.get(t.getInverseBindMatrices())),t.getSkeleton()&&(r.skeleton=o.nodeIndexMap.get(t.getSkeleton())),r.joints=t.listJoints().map(function(t){return o.nodeIndexMap.get(t)}),o.skinIndexMap.set(t,n),r}),r.listNodes().forEach(function(t,n){var r=u.nodes[n];t.getMesh()&&(r.mesh=o.meshIndexMap.get(t.getMesh())),t.getCamera()&&(r.camera=o.cameraIndexMap.get(t.getCamera())),t.getSkin()&&(r.skin=o.skinIndexMap.get(t.getSkin())),t.listChildren().length>0&&(r.children=t.listChildren().map(function(t){return o.nodeIndexMap.get(t)}))}),u.animations=r.listAnimations().map(function(t){var n=o.createPropertyDef(t),r=new Map;return n.samplers=t.listSamplers().map(function(t,n){var i=o.createPropertyDef(t);return i.input=o.accessorIndexMap.get(t.getInput()),i.output=o.accessorIndexMap.get(t.getOutput()),i.interpolation=t.getInterpolation(),r.set(t,n),i}),n.channels=t.listChannels().map(function(t){var n=o.createPropertyDef(t);return n.sampler=r.get(t.getSampler()),n.target={node:o.nodeIndexMap.get(t.getTargetNode()),path:t.getTargetPath()},n}),n}),u.scenes=r.listScenes().map(function(t){var n=o.createPropertyDef(t);return n.nodes=t.listChildren().map(function(t){return o.nodeIndexMap.get(t)}),n}),u.extensionsUsed=r.listExtensionsUsed().map(function(t){return t.extensionName}),u.extensionsRequired=r.listExtensionsRequired().map(function(t){return t.extensionName}),r.listExtensionsUsed().forEach(function(t){return t.write(o)}),function(t){var n=[];for(var r in t){var i=t[r];Array.isArray(i)&&0===i.length?n.push(r):null!==i&&""!==i||n.push(i)}for(var e=0,u=n;e<u.length;e++)delete t[u[e]]}(u),i},t}(),at=function(){function t(){this.It=A.DEFAULT_INSTANCE,this.ft=[],this.Rt={}}var n=t.prototype;return n.setLogger=function(t){return this.It=t,this},n.registerExtensions=function(t){var n;return(n=this.ft).push.apply(n,t),this},n.registerDependencies=function(t){return Object.assign(this.Rt,t),this},n.readJSON=function(t){return ut.read(t,{extensions:this.ft,dependencies:this.Rt,logger:this.It})},n.writeJSON=function(t,n){if(n.isGLB&&1!==t.getRoot().listBuffers().length)throw new Error("GLB must have exactly 1 buffer.");return ct.write(t,n)},n.binaryToJSON=function(t){var n,r=new Uint32Array(t,0,3);if(1179937895!==r[0])throw new Error("Invalid glTF asset.");if(2!==r[1])throw new Error('Unsupported glTF binary version, "'+r[1]+'".');var i=new Uint32Array(t,12,2),e=i[0],u=new Uint32Array(t,20+e,2);if(1313821514!==i[1]||5130562!==u[1])throw new Error("Unexpected GLB layout.");var s=d.decodeText(t.slice(20,20+e)),o=JSON.parse(s),h=20+e+8,f=t.slice(h,h+u[0]);return{json:o,resources:(n={},n["@glb.bin"]=f,n)}},n.readBinary=function(t){return this.readJSON(this.binaryToJSON(t))},n.writeBinary=function(t){var n=this.writeJSON(t,{basename:"",isGLB:!0,logger:this.It}),r=n.resources,i=JSON.stringify(n.json),e=d.pad(d.encodeText(i),32),u=new Uint32Array([e.byteLength,1313821514]).buffer,s=d.concat([u,e]),o=d.pad(Object.values(r)[0]||new ArrayBuffer(0),0),h=new Uint32Array([o.byteLength,5130562]).buffer,f=d.concat([h,o]),c=new Uint32Array([1179937895,2,12+s.byteLength+f.byteLength]).buffer;return d.concat([c,s,f])},t}(),vt=function(t){function n(){var n;return(n=t.call(this)||this).Nt=require("fs"),n.Ot=require("path"),n}i(n,t);var r=n.prototype;return r.read=function(t){var n=this.readAsJSON(t);return ut.read(n,{extensions:this.ft,dependencies:this.Rt,logger:this.It})},r.readAsJSON=function(t){return t.match(/\.glb$/)||t.match(/^data:application\/octet-stream;/)?this.Ut(t):this.jt(t)},r.write=function(t,n){t.match(/\.glb$/)?this._t(t,n):this.kt(t,n)},r.Ut=function(t){var n=this.Nt.readFileSync(t),r=d.trim(n);return this.binaryToJSON(r)},r.jt=function(t){var n=this,r=this.Ot.dirname(t),i={json:JSON.parse(this.Nt.readFileSync(t,"utf8")),resources:{}};return[].concat(i.json.images||[],i.json.buffers||[]).forEach(function(t){if(t.uri)if(t.uri.match(/data:/)){var e="__"+T()+"."+p.extension(t.uri);i.resources[e]=d.createBufferFromDataURI(t.uri),t.uri=e}else{var u=n.Ot.resolve(r,t.uri);i.resources[t.uri]=d.trim(n.Nt.readFileSync(u))}}),i},r.kt=function(t,n){var r=ct.write(n,{basename:p.basename(t),isGLB:!1,logger:this.It}),i=r.json,e=r.resources,u=this.Nt,s=this.Ot,o=s.dirname(t);u.writeFileSync(t,JSON.stringify(i,null,2)),Object.keys(e).forEach(function(t){var n=Buffer.from(e[t]);u.writeFileSync(s.join(o,t),n)})},r._t=function(t,n){var r=Buffer.from(this.writeBinary(n));this.Nt.writeFileSync(t,r)},n}(at),lt={},dt=function(t){function n(n){var r;return void 0===n&&(n=lt),(r=t.call(this)||this).Ct=n,r}i(n,t);var r=n.prototype;return r.read=function(t){var n=this;return this.readAsJSON(t).then(function(t){return n.readJSON(t)})},r.readAsJSON=function(t){return t.match(/\.glb$/)||t.match(/^data:application\/octet-stream;/)?this.Ut(t):this.jt(t)},r.jt=function(t){var n=this,r={json:{},resources:{}};return fetch(t,this.Ct).then(function(t){return t.json()}).then(function(t){r.json=t;var i=[].concat(t.images||[],t.buffers||[]).map(function(t){if(t.uri)return fetch(t.uri,n.Ct).then(function(t){return t.arrayBuffer()}).then(function(n){r.resources[t.uri]=n})});return Promise.all(i).then(function(){return r})})},r.Ut=function(t){var n=this;return fetch(t,this.Ct).then(function(t){return t.arrayBuffer()}).then(function(t){return n.binaryToJSON(t)})},n}(at);exports.Accessor=N,exports.Animation=O,exports.AnimationChannel=U,exports.AnimationSampler=j,exports.Buffer=_,exports.BufferUtils=d,exports.COPY_IDENTITY=M,exports.Camera=k,exports.ColorUtils=w,exports.Document=tt,exports.Extension=nt,exports.ExtensionProperty=C,exports.FileUtils=p,exports.GLB_BUFFER="@glb.bin",exports.Graph=c,exports.GraphChild=a,exports.ImageUtils=x,exports.Link=h,exports.Logger=A,exports.Material=D,exports.MathUtils=b,exports.Mesh=G,exports.Node=F,exports.NodeIO=vt,exports.Primitive=J,exports.PrimitiveTarget=z,exports.Property=S,exports.ReaderContext=rt,exports.Root=q,exports.Scene=$,exports.Skin=Y,exports.Texture=H,exports.TextureInfo=V,exports.WebIO=dt,exports.WriterContext=ot,exports.uuid=T;
//# sourceMappingURL=core.js.map
